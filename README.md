# ЁЯУо ржПржХржЯрж┐ рж╕ржорзНржкрзВрж░рзНржг ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи in Linux using (Postfix, Dovecot, Roundcube)

ржПржЗ ржмрж┐рж╕рзНрждрзГржд ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛ ржЖржкржирж╛ржХрзЗ ржЙржмрзБржирзНржЯрзБрждрзЗ ржПржХржЯрж┐ ржПржирзНржЯрж╛рж░ржкрзНрж░рж╛ржЗржЬ-ржЧрзНрж░рзЗржбрзЗрж░, рж╕ржорзНржкрзВрж░рзНржг ржлрж┐ржЪрж╛рж░ржпрзБржХрзНржд ржПржмржВ ржмрж┐ржирж╛ржорзВрж▓рзНржпрзЗ ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзЗржЯржЖржк ржХрж░рж╛рж░ ржкрзНрж░рж╛ржержорж┐ржХ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ ржмрзБржЭрж┐рзЯрзЗ ржжрзЗржмрзЗред ржЖржорж░рж╛ ржорзЗржЗрж▓ ржЖржжрж╛ржи-ржкрзНрж░ржжрж╛ржирзЗрж░ ржЬржирзНржп **Postfix**, ржорзЗржЗрж▓ ржбрзЗрж▓рж┐ржнрж╛рж░рж┐рж░ ржЬржирзНржп **Dovecot** ржПржмржВ ржУрзЯрзЗржмржорзЗржЗрж▓ ржмрзНржпржмрж╕рзНржерж╛ржкржирж╛рж░ ржЬржирзНржп **Roundcube** ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмред ржЙржЗржирзНржбрзЛржЬрзЗ ржорж╛ржЗржХрзНрж░рзЛрж╕ржлржЯ ржПржХрзНрж╕ржЪрзЗржЮрзНржЬрзЗрж░ ржорждрзЛ ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзЗржЯржЖржкрзЗрж░ ржмрж┐ржнрж┐ржирзНржи ржЙржкрж╛рзЯ ржерж╛ржХрж▓рзЗржУ, ржПржЗ ржЯрж┐ржЙржЯрзЛрж░рж┐рзЯрж╛рж▓ржЯрж┐ рж▓рж┐ржирж╛ржХрзНрж╕-ржнрж┐рждрзНрждрж┐ржХ ржПржХржЯрж┐ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА рж╕ржорж╛ржзрж╛ржи ржирж┐рзЯрзЗ ржЖрж▓рзЛржЪржирж╛ ржХрж░ржмрзЗред

## ржорзВрж▓ ржЙржкрж╛ржжрж╛ржирж╕ржорзВрж╣

ржЖржорж░рж╛ ржпрзЗ ржкрзНрж░ржзрж╛ржи рж╕ржлржЯржУрзЯрзНржпрж╛рж░ ржЙржкрж╛ржжрж╛ржиржЧрзБрж▓рзЛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржм рждрж╛ ржирж┐ржЪрзЗ ржжрзЗржУрзЯрж╛ рж╣рж▓рзЛ:

1.  **Postfix**: Postfix рж╣рж▓рзЛ ржПржХржЯрж┐ **ржорзЗржЗрж▓ ржЯрзНрж░рж╛ржирзНрж╕ржлрж╛рж░ ржПржЬрзЗржирзНржЯ (MTA)**ред ржПржЯрж┐ ржЗржорзЗрж▓ ржкрж╛ржарж╛ржирзЛ ржПржмржВ ржЧрзНрж░рж╣ржг ржХрж░рж╛рж░ ржорзВрж▓ рж╕ржлржЯржУрзЯрзНржпрж╛рж░, ржпрж╛ ржПржХржЯрж┐ рж╕ржорзНржкрзВрж░рзНржг ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржЬржирзНржп ржЕржкрж░рж┐рж╣рж╛рж░рзНржпред
2.  **Dovecot**: Dovecot ржПржХржЯрж┐ **ржорзЗржЗрж▓ ржбрзЗрж▓рж┐ржнрж╛рж░рж┐ ржПржЬрзЗржирзНржЯ (MDA)** рж╣рж┐рж╕рзЗржмрзЗ ржХрж╛ржЬ ржХрж░рзЗред ржПржЯрж┐ ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржПржмржВ рж╕рж╛рж░рзНржнрж╛рж░ ржерзЗржХрзЗ ржЗржорзЗрж▓ ржбрзЗрж▓рж┐ржнрж╛рж░рж┐ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗ, ржпрж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ IMAP ржПржмржВ POP3 ржкрзНрж░рзЛржЯрзЛржХрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рждрж╛ржжрзЗрж░ ржорзЗржЗрж▓ржмржХрзНрж╕рзЗ ржкрзНрж░ржмрзЗрж╢ ржХрж░рждрзЗ ржжрзЗрзЯред
3.  **Roundcube**: Roundcube ржПржХржЯрж┐ **ржУрзЯрзЗржмржорзЗржЗрж▓ ржХрзНрж▓рж╛рзЯрзЗржирзНржЯ**ред ржПржЯрж┐ ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржЗржорзЗрж▓ ржкрж░рж┐ржЪрж╛рж▓ржирж╛рж░ ржЬржирзНржп ржПржХржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА-ржмрж╛ржирзНржзржм ржУрзЯрзЗржм ржЗржирзНржЯрж╛рж░ржлрзЗрж╕ рж╕рж░ржмрж░рж╛рж╣ ржХрж░рзЗ, ржпрж╛ ржУрзЯрзЗржм ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗрж░ ржорж╛ржзрзНржпржорзЗ ржЖржкржирж╛рж░ ржорзЗржЗрж▓ржмржХрзНрж╕ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рж╛рж░ ржПржХржЯрж┐ рж╕рж╣ржЬ ржПржмржВ ржХрж╛рж╕рзНржЯржорж╛ржЗржЬржпрзЛржЧрзНржп ржЙржкрж╛рзЯред

## ржкрзВрж░рзНржмрж╢рж░рзНржд

рж╢рзБрж░рзБ ржХрж░рж╛рж░ ржЖржЧрзЗ, ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи ржпрзЗ ржЖржкржирж╛рж░ ржирж┐ржЪрзЗрж░ ржмрж┐рж╖рзЯржЧрзБрж▓рзЛ ржкрзНрж░рж╕рзНрждрзБржд ржЖржЫрзЗ:

1.  **ржмрзИржз ржбрзЛржорзЗржЗржи**: ржПржХржЯрж┐ ржирж┐ржмржирзНржзрж┐ржд ржбрзЛржорзЗржЗржи ржирж╛ржо (ржпрзЗржоржи: `paulco.xyz`)ред
2.  **DNS рж╕рж╛рж░рзНржнрж╛рж░**: ржПржХржЯрж┐ DNS рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕, ржпрзЗржЦрж╛ржирзЗ ржЖржкржирж┐ ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржирзЗрж░ DNS рж░рзЗржХрж░рзНржбржЧрзБрж▓рзЛ (A, MX, TXT) ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред
3.  **ржЙржмрзБржирзНржЯрзБ 22.04.2 LTS рж╕рж╛рж░рзНржнрж╛рж░**: ржПржХржЯрж┐ рж╕рж╛рж░рзНржнрж╛рж░ ржЗржирж╕рзНржЯрзНржпрж╛ржирзНрж╕, ржпрж╛рж░ ржкрзНрж░рж╕рзНрждрж╛ржмрж┐ржд рж╕рзНржкрзЗрж╕рж┐ржлрж┐ржХрзЗрж╢ржиржЧрзБрж▓рзЛ рж╣рж▓рзЛ:
      * 4 CPU ржХрзЛрж░
      * 8 GB RAM
      * 50 GB рж╕рзНржЯрзЛрж░рзЗржЬ
      * ржкрж╛ржмрж▓рж┐ржХ ржЖржЗржкрж┐ рж╕рж╣ 1 NIC

-----

## ржмрзЗрж╕рж┐ржХ рж╕рж╛рж░рзНржнрж╛рж░ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи

ржЪрж▓рзБржи, ржЖржкржирж╛рж░ ржЙржмрзБржирзНржЯрзБ рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржХрж┐ржЫрзБ ржкрзНрж░рж╛ржержорж┐ржХ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржжрж┐рзЯрзЗ рж╢рзБрж░рзБ ржХрж░рж┐ред

### ржЕржкрж╛рж░рзЗржЯрж┐ржВ рж╕рж┐рж╕рзНржЯрзЗржорзЗрж░ рж╕ржВрж╕рзНржХрж░ржг ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи

```bash
cat /etc/os-release
hostnamectl
```

### рж╕рж┐ржкрж┐ржЗржЙ рждржерзНржп ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи

```bash
lscpu
cat /proc/cpuinfo
nproc
```

### RAM ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи

```bash
free -h
```

### ржбрж┐рж╕рзНржХрзЗрж░ рж╕рзНржерж╛ржи ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи

```bash
df -h
```

### рж╣рзЛрж╕рзНржЯржирзЗржо ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржи

ржЖржкржирж╛рж░ ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржЬржирзНржп ржПржХржЯрж┐ **рж╕ржорзНржкрзВрж░рзНржг ржХрзЛржпрж╝рж╛рж▓рж┐ржлрж╛ржЗржб ржбрзЛржорзЗржЗржи ржирж╛ржо (FQDN)** рж╕рзЗржЯ ржХрж░рж╛ ржЕрждрзНржпржирзНржд ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржгред

```bash
sudo hostnamectl set-hostname mail.paulco.xyz
```

### рж╕рж╛рж░рзНржнрж╛рж░ ржЖржЗржкрж┐ ржПржмржВ FQDN рж╣рзЛрж╕рзНржЯ ржлрж╛ржЗрж▓рзЗ ржпрзЛржЧ ржХрж░рзБржи

ржЖржкржирж╛рж░ `/etc/hosts` ржлрж╛ржЗрж▓ржЯрж┐ ржПржбрж┐ржЯ ржХрж░рзБржи ржПржмржВ ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржЖржЗржкрж┐ ржЕрзНржпрж╛ржбрзНрж░рзЗрж╕ржХрзЗ рждрж╛рж░ FQDN ржПржмржВ рж╢рж░рзНржЯ рж╣рзЛрж╕рзНржЯржирзЗржорзЗрж░ рж╕рж╛ржерзЗ ржорзНржпрж╛ржк ржХрж░рзБржиред `192.168.3.55` ржПрж░ ржЬрж╛рзЯржЧрж╛рзЯ ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржЖрж╕рж▓ ржЖржЗржкрж┐ ржЕрзНржпрж╛ржбрзНрж░рзЗрж╕ржЯрж┐ ржмрж╕рж╛ржиред

```bash
sudo nano /etc/hosts
```

ржирж┐ржЪрзЗрж░ рж▓рж╛ржЗржиржЯрж┐ ржпрзЛржЧ ржХрж░рзБржи:

```
192.168.3.55 mail.paulco.xyz mail
```

### FQDN ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи

ржЖржкржирж╛рж░ FQDN рж╕ржарж┐ржХржнрж╛ржмрзЗ рж╕рзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ ржХрж┐ржирж╛ рждрж╛ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи:

```bash
hostname -f
```

### ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржЬржирзНржп ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржпрзЛржЧ ржХрж░рзБржи

ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░ ржкрж░рж┐ржЪрж╛рж▓ржирж╛рж░ ржЬржирзНржп ржПржХржЯрж┐ ржбрзЗржбрж┐ржХрзЗржЯрзЗржб ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рждрзИрж░рж┐ ржХрж░рж╛ ржПржХржЯрж┐ ржнрж╛рж▓рзЛ ржЕржирзБрж╢рзАрж▓ржиред

```bash
sudo adduser mail
```

### рж╕рзБржбрзЛ ржкрзНрж░рж┐ржнрж┐рж▓рзЗржЬ ржжрж┐ржи

ржирждрзБржи рждрзИрж░рж┐ ржХрж░рж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ `sudo` ржЧрзНрж░рзБржкрзЗ ржпрзЛржЧ ржХрж░рзБржиред

```bash
sudo usermod -aG sudo mail
```

### ржорзЗржЗрж▓ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж╣рж┐рж╕рзЗржмрзЗ рж▓ржЧржЗржи ржХрж░рзБржи

ржкрж░ржмрж░рзНрждрзА ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржиржЧрзБрж▓рзЛ рж╕ржорзНржкрж╛ржжржи ржХрж░рждрзЗ ржирждрзБржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржХрж╛ржЫрзЗ рж╕рзНржпрзБржЗржЪ ржХрж░рзБржиред

```bash
su mail
```

-----

## Postfix ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░ ржЗржирж╕рзНржЯрж▓ ржПржмржВ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

ржПржЦржи, ржЖржорж░рж╛ Postfix ржЗржирж╕рзНржЯрж▓ ржХрж░ржм ржПржмржВ ржПрж░ ржкрзНрж░рж╛ржержорж┐ржХ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи рж╕ржорзНржкржирзНржи ржХрж░ржмред

### ржкрзНржпрж╛ржХрзЗржЬ ржЖржкржбрзЗржЯ ржПржмржВ ржЖржкржЧрзНрж░рзЗржб ржХрж░рзБржи

рж╕рж░рзНржмржжрж╛ ржЖржкржирж╛рж░ рж╕рж┐рж╕рзНржЯрзЗржорзЗрж░ ржкрзНржпрж╛ржХрзЗржЬ рждрж╛рж▓рж┐ржХрж╛ ржЖржкржбрзЗржЯ ржХрж░рзЗ ржПржмржВ ржмрж┐ржжрзНржпржорж╛ржи ржкрзНржпрж╛ржХрзЗржЬржЧрзБрж▓рж┐ ржЖржкржЧрзНрж░рзЗржб ржХрж░рзЗ рж╢рзБрж░рзБ ржХрж░рзБржиред

```bash
sudo apt-get update -y
sudo apt-get upgrade -y
```

### Postfix ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

ржЗржирж╕рзНржЯрж▓рзЗрж╢ржирзЗрж░ рж╕ржоржпрж╝, ржЖржкржирж╛ржХрзЗ Postfix ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рждрзЗ ржмрж▓рж╛ рж╣ржмрзЗред "Internet Site" ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи ржПржмржВ "System mail name" ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржи ржирж╛ржорзЗрж░ (ржпрзЗржоржи, `paulco.xyz`) ржорждрзЛ рж╕рзЗржЯ ржХрж░рждрзЗ ржнрзБрж▓ржмрзЗржи ржирж╛ред

```bash
sudo apt-get install postfix -y
```

### Postfix рж╕ржВрж╕рзНржХрж░ржг ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи

```bash
postconf mail_version
```

### Postfix рж╕рж╛рж░рзНржнрж┐рж╕рзЗрж░ ржЕржмрж╕рзНржерж╛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи

```bash
sudo systemctl status postfix
```

### Postfix ржкрзБржирж░рж╛ржпрж╝ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи (ржпржжрж┐ ржкрзНрж░ржпрж╝рзЛржЬржи рж╣ржпрж╝)

ржпржжрж┐ ржЖржкржирж┐ ржкрзНрж░рж╛ржержорж┐ржХ рж╕рзЗржЯржЖржкрзЗрж░ рж╕ржоржпрж╝ ржХрзЛржирзЛ ржнрзБрж▓ ржХрж░рзЗ ржерж╛ржХрзЗржи ржмрж╛ Postfix ржкрзБржирж░рж╛ржпрж╝ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржи рж╣ржпрж╝, рждрж╛рж╣рж▓рзЗ ржЖржкржирж┐ ржПржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи:

```bash
sudo dpkg-reconfigure postfix
```

-----

## Postfix ржПрж░ ржЙржирзНржиржд ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи

ржорзЗржЗрж▓ ржмрзНржпржмрж╕рзНржерж╛ржкржирж╛рж░ ржЙржирзНржирждрж┐рж░ ржЬржирзНржп Postfix ржХрзЗ ржлрж╛ржЗржи-ржЯрж┐ржЙржи ржХрж░рж╛ ржпрж╛ржХред

### Postfix ржПрж░ ржорзВрж▓ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓рзЗрж░ ржмрзНржпрж╛ржХржЖржк ржирж┐ржи

ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж╛рж░ ржЖржЧрзЗ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ржЧрзБрж▓рж┐рж░ ржмрзНржпрж╛ржХржЖржк ржирзЗржУржпрж╝рж╛ рж╕ржмрж╕ржоржпрж╝ ржПржХржЯрж┐ ржнрж╛рж▓рзЛ ржЕржнрзНржпрж╛рж╕ред

```bash
sudo cp /etc/postfix/main.cf /etc/postfix/main.cf.backup
```

### Maildir ржПрж░ ржЕржмрж╕рзНржерж╛ржи ржпрзЛржЧ ржХрж░рзБржи

ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржорзЗржЗрж▓ржмржХрзНрж╕рзЗрж░ ржЬржирзНржп Maildir ржлрж░ржорзНржпрж╛ржЯ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж░рждрзЗ Postfix ржПрж░ ржорзВрж▓ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ржЯрж┐ ржПржбрж┐ржЯ ржХрж░рзБржиред ржПржЯрж┐ ржкрзБрж░рзЛржирзЛ mbox ржлрж░ржорзНржпрж╛ржЯрзЗрж░ ржЪрзЗржпрж╝рзЗ ржЗржорзЗрж▓ рж╕ржВрж░ржХрзНрж╖ржгрзЗрж░ ржПржХржЯрж┐ ржЖржзрзБржирж┐ржХ ржПржмржВ ржиржоржирзАржпрж╝ ржЙржкрж╛ржпрж╝ред

```bash
sudo nano /etc/postfix/main.cf
```

ржлрж╛ржЗрж▓рзЗрж░ рж╢рзЗрж╖рзЗ ржирж┐ржЪрзЗрж░ рж▓рж╛ржЗржиржЯрж┐ ржпрзЛржЧ ржХрж░рзБржи:

```
home_mailbox = Maildir/
```

### Postfix рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзБржи

ржкрж░рж┐ржмрж░рзНрждржиржЧрзБрж▓рзЛ ржХрж╛рж░рзНржпржХрж░ ржХрж░рждрзЗ Postfix рж╕рж╛рж░рзНржнрж┐рж╕ржЯрж┐ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзБржиред

```bash
sudo systemctl restart postfix
```

-----

## Postfix ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рж╛

ржХрж┐ржЫрзБ ржорзМрж▓рж┐ржХ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзЗ Postfix ржкрзНрж░рждрзНржпрж╛рж╢рж┐рждржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░ржЫрзЗ ржХрж┐ржирж╛ рждрж╛ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржиред

### SMTP рж╕рж╛рж░рзНржнрж╛рж░ ржкрж┐ржВ ржХрж░рзБржи

ржПржХржЯрж┐ ржмрж╛рж╣рзНржпрж┐ржХ SMTP рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ (ржпрзЗржоржи, Gmail) рж╕рж╛ржерзЗ рж╕ржВржпрзЛржЧ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржиред

```bash
ping smtp.gmail.com
```

### ржмрж╛рж╣рзНржпрж┐ржХ SMTP рж╕ржВржпрзЛржЧ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи (ржкрзЛрж░рзНржЯ 25)

ржкрзЛрж░рзНржЯ 25-ржП ржПржХржЯрж┐ ржмрж╛рж╣рзНржпрж┐ржХ SMTP рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ рж╕рж╛ржерзЗ рж╕ржВржпрзЛржЧ ржХрж░рждрзЗ `telnet` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред ржПржЯрж┐ ржЖржЙржЯржЧрзЛржпрж╝рж┐ржВ рж╕ржВржпрзЛржЧ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзЗред

```bash
telnet gmail-smtp-in.l.google.com 25
```

ржЖржкржирж╛рж░ ржирж┐ржЪрзЗрж░ ржорждрзЛ ржПржХржЯрж┐ ржЖржЙржЯржкрзБржЯ ржжрзЗржЦрж╛ ржЙржЪрж┐ржд:

```
Trying 142.251.12.108...
Connected to gmail-smtp-in.l.google.com.
Escape character is '^]'.
220 smtp.gmail.com ESMTP t187-200...
```

`quit` ржЯрж╛ржЗржк ржХрж░рзЗ Enter ржЪрж╛ржкрзБржи `telnet` ржерзЗржХрзЗ ржмрзЗрж░ рж╣ржУржпрж╝рж╛рж░ ржЬржирзНржпред

### ржмрж╛рж╣рзНржпрж┐ржХ SMTP рж╕ржВржпрзЛржЧ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи (ржкрзЛрж░рзНржЯ 587)

ржкрзЛрж░рзНржЯ 587 ржПрж░ ржЬржирзНржп `telnet` ржкрж░рзАржХрзНрж╖рж╛ржЯрж┐ ржкрзБржирж░рж╛ржмрзГрждрзНрждрж┐ ржХрж░рзБржи, ржпрж╛ рж╕рж╛ржзрж╛рж░ржгржд ржкрзНрж░ржорж╛ржгрзАржХрж░ржгрзЗрж░ рж╕рж╛ржерзЗ ржЬржорж╛ ржжрзЗржУржпрж╝рж╛рж░ ржЬржирзНржп ржмрзНржпржмрж╣рзГржд рж╣ржпрж╝ред

```bash
telnet smtp.gmail.com 587
```

ржЖржкржирж╛рж░ ржПржХржЯрж┐ ржЕржирзБрж░рзВржк ржЖржЙржЯржкрзБржЯ ржжрзЗржЦрж╛ ржЙржЪрж┐рждред `quit` ржЯрж╛ржЗржк ржХрж░рзЗ Enter ржЪрж╛ржкрзБржи `telnet` ржерзЗржХрзЗ ржмрзЗрж░ рж╣ржУржпрж╝рж╛рж░ ржЬржирзНржпред

### Mailutils ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

`mailutils` ржЗржорзЗрж▓ ржкрж╛ржарж╛ржирзЛрж░ ржЬржирзНржп ржПржХржЯрж┐ рж╕рж╣ржЬ ржХржорж╛ржирзНржб-рж▓рж╛ржЗржи ржЗржЙржЯрж┐рж▓рж┐ржЯрж┐ рж╕рж░ржмрж░рж╛рж╣ ржХрж░рзЗред

```bash
sudo apt-get install mailutils -y
```

### Gmail ржП ржПржХржЯрж┐ ржЯрзЗрж╕рзНржЯ ржЗржорзЗрж▓ ржкрж╛ржарж╛ржи

ржПржХржЯрж┐ ржмрж╛рж╣рзНржпрж┐ржХ Gmail ржарж┐ржХрж╛ржирж╛ржпрж╝ ржПржХржЯрж┐ ржЯрзЗрж╕рзНржЯ ржЗржорзЗрж▓ ржкрж╛ржарж╛ржиред `sumonpaul267@gmail.com` ржПрж░ ржЬрж╛ржпрж╝ржЧрж╛ржпрж╝ ржЖржкржирж╛рж░ ржХрж╛ржЩрзНржХрзНрж╖рж┐ржд ржкрзНрж░рж╛ржкржХрзЗрж░ ржарж┐ржХрж╛ржирж╛ ржмрж╕рж╛ржиред

```bash
echo "Hey, I am dev stack. I want to connect with you sumon" | mail -s "Connected Mail" sumonpaul267@gmail.com
```

ржмржбрж┐ ржЯрж╛ржЗржк ржХрж░рж╛рж░ ржкрж░ ржЗржорзЗрж▓ ржкрж╛ржарж╛ржирзЛрж░ ржЬржирзНржп `Ctrl+D` ржЪрж╛ржкрзБржиред

### рж╕рзНржерж╛ржирзАржпрж╝ Telnet ржжрж┐ржпрж╝рзЗ Postfix ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи

ржкрзЛрж░рзНржЯ 25-ржП ржЖржкржирж╛рж░ Postfix рж╕рж╛рж░рзНржнрж╛рж░рзЗ рж╕рзНржерж╛ржирзАржпрж╝ рж╕ржВржпрзЛржЧ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржиред `192.168.102.250` ржПрж░ ржЬрж╛ржпрж╝ржЧрж╛ржпрж╝ ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржЖрж╕рж▓ ржЖржЗржкрж┐ ржЕрзНржпрж╛ржбрзНрж░рзЗрж╕ ржмрж╛ `localhost` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред

```bash
telnet 192.168.102.250 25
```

### ржорзЗржЗрж▓ рж▓ржЧ ржоржирж┐ржЯрж░ ржХрж░рзБржи

рж░рж┐ржпрж╝рзЗрж▓-ржЯрж╛ржЗржо ржорзЗржЗрж▓ тАЛтАЛржХрж╛рж░рзНржпржХрж▓рж╛ржк ржжрзЗржЦрждрзЗ ржПржмржВ ржпрзЗржХрзЛржирзЛ рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржи ржХрж░рждрзЗ, ржорзЗржЗрж▓ тАЛтАЛрж▓ ржлрж╛ржЗрж▓ржЯрж┐ ржоржирж┐ржЯрж░ ржХрж░рзБржиред

```bash
tail -f /var/log/mail.log
```

-----

## IMAP ржПржмржВ POP ржПрж░ ржЬржирзНржп Dovecot ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛

Dovecot ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржорзЗржЗрж▓ржмржХрзНрж╕рзЗ ржЗржорзЗрж▓ рж╕рж░ржмрж░рж╛рж╣ ржХрж░ржмрзЗ ржПржмржВ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯржжрзЗрж░ IMAP ржПржмржВ POP3 ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж╕рзЗржЧрзБрж▓рж┐ржХрзЗ ржкрзБржирж░рзБржжрзНржзрж╛рж░ ржХрж░рж╛рж░ ржЕржирзБржорждрж┐ ржжрзЗржмрзЗред

### Dovecot IMAP ржПржмржВ POP3 ржбрзЗржоржи ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

```bash
sudo apt install dovecot-imapd dovecot-pop3d -y
```

### Dovecot рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржПржмржВ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи

```bash
sudo systemctl restart dovecot
sudo systemctl status dovecot
```

### Dovecot ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓рзЗрж░ ржмрзНржпрж╛ржХржЖржк ржирж┐ржи

```bash
sudo cp /etc/dovecot/dovecot.conf /etc/dovecot/dovecot.conf.bak
```

### Dovecot ржкрзНрж░рзЛржЯрзЛржХрж▓ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

IMAP ржПржмржВ POP3 ржкрзНрж░рзЛржЯрзЛржХрж▓ рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рждрзЗ Dovecot ржПрж░ ржкрзНрж░ржзрж╛ржи ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ржЯрж┐ ржПржбрж┐ржЯ ржХрж░рзБржиред

```bash
sudo nano /etc/dovecot/dovecot.conf
```

ржирж┐ржЪрзЗрж░ рж▓рж╛ржЗржиржЯрж┐ ржЖржиржХржорзЗржирзНржЯ ржХрж░рзБржи ржмрж╛ ржпрзЛржЧ ржХрж░рзБржи:

```
protocols = pop3 pop3s imap imaps
```

### Dovecot Listen Address ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

Dovecot ржХрзЗ рж╕ржХрж▓ ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ ржЗржирзНржЯрж╛рж░ржлрзЗрж╕рзЗ рж╢рзЛржирж╛рж░ ржЕржирзБржорждрж┐ ржжрж┐рждрзЗ `listen` рж▓рж╛ржЗржиржЯрж┐ ржЖржиржХржорзЗржирзНржЯ ржХрж░рзБржиред

```bash
listen = *
```

### ржкрзНрж░ржорж╛ржгрзАржХрж░ржг рж╕рзЗржЯрж┐ржВрж╕ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ржЯрж┐ ржПржбрж┐ржЯ ржХрж░рзБржиред ржЖржкржирж╛рж░ ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝рждрж╛ ржЕржирзБржпрж╛ржпрж╝рзА, ржЖржкржирж┐ ржкрзНрж▓рзЗржЗржи ржЯрзЗржХрзНрж╕ржЯ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг рж╕ржХрзНрж╖ржо ржмрж╛ ржирж┐рж╖рзНржХрзНрж░рж┐ржпрж╝ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред ржЙржирзНржиржд ржирж┐рж░рж╛ржкрждрзНрждрж╛рж░ ржЬржирзНржп, TLS/SSL ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рж╛ рж╣рж▓рзЗ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржкрж░рж┐ржмрзЗрж╢рзЗ ржПржЯрж┐ ржирж┐рж╖рзНржХрзНрж░рж┐ржпрж╝ ржХрж░рж╛ рж╕рж╛ржзрж╛рж░ржгржд рж╕рзБржкрж╛рж░рж┐рж╢ ржХрж░рж╛ рж╣ржпрж╝ред

```bash
sudo nano /etc/dovecot/conf.d/10-auth.conf
```

ржЖржкржирж╛рж░ ржкржЫржирзНржж ржЕржирзБржпрж╛ржпрж╝рзА `disable_plaintext_auth` ржЖржиржХржорзЗржирзНржЯ ржХрж░рзБржи ржПржмржВ рж╕рзЗржЯ ржХрж░рзБржиред ржкрзНрж░рж╛ржержорж┐ржХ ржкрж░рзАржХрзНрж╖рж╛рж░ ржЬржирзНржп, `no` рж╕рж╣ржЬ рж╣рждрзЗ ржкрж╛рж░рзЗ, рждржмрзЗ ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗрж░ ржЬржирзНржп, TLS рж╕рж╣ `yes` рж╕рзБржкрж╛рж░рж┐рж╢ ржХрж░рж╛ рж╣ржпрж╝ред

```
disable_plaintext_auth = no
```

### ржорзЗржЗрж▓ рж▓рзЛржХрзЗрж╢ржи ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

Dovecot ржПрж░ ржорзЗржЗрж▓ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржирзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржорзЗржЗрж▓ржмржХрзНрж╕рзЗрж░ ржЬржирзНржп Maildir рж▓рзЛржХрзЗрж╢ржи ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж░рзБржиред

```bash
sudo nano /etc/dovecot/conf.d/10-mail.conf
```

ржирж┐ржЪрзЗрж░ рж▓рж╛ржЗржиржЯрж┐ ржЖржиржХржорзЗржирзНржЯ ржХрж░рзБржи:

```
mail_location = maildir:~/Maildir
```

ржПржмржВ ржпржжрж┐ mbox рж▓рж╛ржЗржиржЯрж┐ ржЙржкрж╕рзНржерж┐ржд ржерж╛ржХрзЗ рждржмрзЗ ржПржЯрж┐ржХрзЗ ржХржорзЗржирзНржЯ ржЖржЙржЯ ржХрж░рзБржи:

```
#mail_location = mbox:~/mail:INBOX=/var/mail/%u
```

### Dovecot ржПржмржВ Postfix рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзБржи

Dovecot ржПрж░ ржкрж░рж┐ржмрж░рзНрждржиржЧрзБрж▓рзЛ ржкрзНрж░ржпрж╝рзЛржЧ ржХрж░рзБржи ржПржмржВ рждрж╛рж░рж╛ рж╕ржарж┐ржХржнрж╛ржмрзЗ ржЗржирзНржЯрж┐ржЧрзНрж░рзЗржЯ рж╣ржпрж╝рзЗржЫрзЗ рждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рждрзЗ Dovecot ржПржмржВ Postfix ржЙржнржпрж╝ржЗ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзБржиред

```bash
sudo systemctl restart dovecot
sudo systemctl restart postfix
```

-----

## ржЙржмрзБржирзНржЯрзБрждрзЗ ржУрзЯрзЗржмржорзЗржЗрж▓рзЗрж░ ржЬржирзНржп Roundcube ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛

Roundcube ржЖржкржирж╛рж░ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ рждрж╛ржжрзЗрж░ ржЗржорзЗрж▓ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рж╛рж░ ржЬржирзНржп ржПржХржЯрж┐ ржУрзЯрзЗржм-ржнрж┐рждрзНрждрж┐ржХ ржЗржирзНржЯрж╛рж░ржлрзЗрж╕ рж╕рж░ржмрж░рж╛рж╣ ржХрж░ржмрзЗред

### Apache, MariaDB, ржПржмржВ PHP ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

Roundcube ржХрж╛ржЬ ржХрж░рж╛рж░ ржЬржирзНржп ржПржХржЯрж┐ ржУрзЯрзЗржм рж╕рж╛рж░рзНржнрж╛рж░ (Apache), ржПржХржЯрж┐ ржбрж╛ржЯрж╛ржмрзЗрж╕ (MariaDB) ржПржмржВ PHP ржкрзНрж░ржпрж╝рзЛржЬржиред

```bash
sudo apt-get install apache2 mariadb-server php libapache2-mod-php php-mysql -y
```

### Apache Rewrite ржоржбрж┐ржЙрж▓ рж╕ржХрзНрж░рж┐рзЯ ржХрж░рзБржи

Roundcube ржПрж░ URL рж░рж┐рж░рж╛ржЗржЯрж┐ржВрзЯрзЗрж░ ржЬржирзНржп Apache rewrite ржоржбрж┐ржЙрж▓ржЯрж┐ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ред

```bash
sudo a2enmod rewrite
```

### Apache рж░рж┐рж▓рзЛржб ржХрж░рзБржи

```bash
sudo systemctl reload apache2
```

### Roundcube ржПрж░ ржЬржирзНржп ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ PHP ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

Roundcube рж╕ржарж┐ржХржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рж╛рж░ ржЬржирзНржп ржЖржкржирж╛рж░ ржмрзЗрж╢ ржХржпрж╝рзЗржХржЯрж┐ PHP ржПржХрзНрж╕ржЯрзЗржирж╢ржи ржкрзНрж░ржпрж╝рзЛржЬржи рж╣ржмрзЗред ржирж┐ржЪрзЗрж░ ржмрж┐ржХрж▓рзНржкржЧрзБрж▓рзЛрж░ ржоржзрзНржпрзЗ **ржПржХржЯрж┐** ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржиред ржкрзНрж░ржержо ржмрж┐ржХрж▓рзНржкржЯрж┐ рж╕рж╛ржзрж╛рж░ржгржд ржЖрж░ржУ ржмрзНржпрж╛ржкржХред

**ржмрж┐ржХрж▓рзНржк 1 (ржкрзНрж░рж╕рзНрждрж╛ржмрж┐ржд):**

```bash
sudo apt install openssl composer php-net-smtp php-mysql php-gd php-xml php-mbstring php-intl php-zip php-json php-pear php-bz2 php-gmp php-imap php-imagick php-auth-sasl php-net-idna2 php-mail-mime php-net-ldap3 php-net-sieve -y
```

**ржмрж┐ржХрж▓рзНржк 2 (ржирж┐рж░рзНржжрж┐рж╖рзНржЯ PHP 7.4 - ржЖржкржирж╛рж░ ржпржжрж┐ PHP 7.4 ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ ржерж╛ржХрзЗ рждржмрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи):**

```bash
sudo apt install php7.4 libapache2-mod-php7.4 php7.4-mysql php-net-ldap2 php-net-ldap3 php-imagick php7.4-common php7.4-gd php7.4-imap php7.4-json php7.4-curl php7.4-zip php7.4-xml php7.4-mbstring php7.4-bz2 php7.4-intl php7.4-gmp php-net-smtp php-mail-mime php-net-idna2 -y
```

**PHP ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржи (ржпржжрж┐ ржЖржкржирж┐ рждрзНрж░рзБржЯрж┐ рж╕ржорзНржорзБржЦрзАржи рж╣ржи):**

ржЖржкржирж┐ ржпржжрж┐ PHP ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛рж░ рж╕ржоржпрж╝ рж╕ржорж╕рзНржпрж╛рж░ рж╕ржорзНржорзБржЦрзАржи рж╣ржи, рждрж╛рж╣рж▓рзЗ ржирждрзБржи рж╕ржВрж╕рзНржХрж░ржгрзЗрж░ ржЬржирзНржп Ondrej PHP рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐ ржпрзЛржЧ ржХрж░рждрзЗ рж╣рждрзЗ ржкрж╛рж░рзЗред

```bash
sudo apt -y install software-properties-common -y
sudo add-apt-repository ppa:ondrej/php -y
sudo apt-get update -y
```

PHP ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛рж░ ржкрж░, Apache рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзБржи:

```bash
sudo systemctl restart apache2
sudo systemctl status apache2
```

### Roundcube ржбрж╛ржЙржирж▓рзЛржб ржПржмржВ ржПржХрзНрж╕ржЯрзНрж░рж╛ржХрзНржЯ ржХрж░рзБржи

Roundcube ржПрж░ GitHub рж░рж┐рж▓рж┐ржЬ ржкрзЗржЬ ржерзЗржХрзЗ рж╕рж░рзНржмрж╢рзЗрж╖ рж╕рзНржерж┐рждрж┐рж╢рзАрж▓ рж╕ржВрж╕рзНржХрж░ржг ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржиред рж╕рж░рзНржмржжрж╛ рж╕рж░рзНржмрж╢рзЗрж╖ рж╕рзНржерж┐рждрж┐рж╢рзАрж▓ рж░рж┐рж▓рж┐ржЬ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржиред (ржПржЗ ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛ ржЕржирзБржпрж╛ржпрж╝рзА, `1.6.1` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ, рждржмрзЗ Roundcube ржУржпрж╝рзЗржмрж╕рж╛ржЗржЯрзЗ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи)ред

```bash
wget https://github.com/roundcube/roundcubemail/releases/download/1.6.1/roundcubemail-1.6.1-complete.tar.gz
tar -xvf roundcubemail-1.6.1-complete.tar.gz
```

### Roundcube ржПрж░ ржЬржирзНржп рж╕рзНржерж╛ржирж╛ржирзНрждрж░рж┐ржд ржПржмржВ ржкрж╛рж░ржорж┐рж╢ржи рж╕рзЗржЯ ржХрж░рзБржи

ржПржХрзНрж╕ржЯрзНрж░рж╛ржХрзНржЯ ржХрж░рж╛ Roundcube ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ ржЖржкржирж╛рж░ ржУрзЯрзЗржм рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржбржХрзБржорзЗржирзНржЯ рж░рзБржЯрзЗ рж╕рж░рж╛ржи ржПржмржВ ржЙржкржпрзБржХрзНржд ржкрж╛рж░ржорж┐рж╢ржи рж╕рзЗржЯ ржХрж░рзБржиред

```bash
sudo mv roundcubemail-1.6.1 /var/www/html/roundcubemail
sudo chown -R www-data:www-data /var/www/html/roundcubemail/
sudo chmod 755 -R /var/www/html/roundcubemail/
```

### Roundcube ржПрж░ ржЬржирзНржп MariaDB ржбрж╛ржЯрж╛ржмрзЗрж╕ ржПржмржВ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рждрзИрж░рж┐ ржХрж░рзБржи

рж░рзБржЯ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж╣рж┐рж╕рзЗржмрзЗ MariaDB ржкрзНрж░ржорзНржкржЯрзЗ ржкрзНрж░ржмрзЗрж╢ ржХрж░рзБржи ржПржмржВ Roundcube ржПрж░ ржЬржирзНржп ржПржХржЯрж┐ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржУ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рждрзИрж░рж┐ ржХрж░рзБржиред рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА, рж╕рзБрж░ржХрзНрж╖рж┐ржд ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржжрж┐ржпрж╝рзЗ `'ubuntu'` ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи ржХрж░рждрзЗ ржнрзБрж▓ржмрзЗржи ржирж╛ред

```bash
sudo mysql -u root
```

```sql
CREATE DATABASE roundcube DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
CREATE USER roundcubeuser@localhost IDENTIFIED BY 'ubuntu';
GRANT ALL PRIVILEGES ON roundcube.* TO roundcubeuser@localhost;
FLUSH PRIVILEGES;
QUIT;
```

### Roundcube ржПрж░ ржкрзНрж░рж╛ржержорж┐ржХ SQL рж╕рзНржХрж┐ржорж╛ ржЖржоржжрж╛ржирж┐ ржХрж░рзБржи

`roundcube` ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржбрж╛ржЯрж╛ржмрзЗрж╕ рж╕рзНржХрж┐ржорж╛ ржЖржоржжрж╛ржирж┐ ржХрж░рзБржиред

```bash
sudo mysql roundcube < /var/www/html/roundcubemail/SQL/mysql.initial.sql
```

### Roundcube ржПрж░ ржЬржирзНржп Apache ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓ рж╣рзЛрж╕рзНржЯ рждрзИрж░рж┐ ржХрж░рзБржи

Roundcube ржПрж░ ржЬржирзНржп ржПржХржЯрж┐ ржирждрзБржи Apache ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓ рж╣рзЛрж╕рзНржЯ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рзБржиред

```bash
sudo nano /etc/apache2/sites-available/roundcube.conf
```

ржирж┐ржЪрзЗрж░ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржиржЯрж┐ ржпрзЛржЧ ржХрж░рзБржиред `mail.paulco.xyz` ржПрж░ ржЬрж╛ржпрж╝ржЧрж╛ржпрж╝ ржЖржкржирж╛рж░ ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ FQDN ржмрж╕рж╛ржиред

```apache
<VirtualHost *:80>
  ServerName mail.paulco.xyz
  DocumentRoot /var/www/html/roundcubemail/
  ErrorLog ${APACHE_LOG_DIR}/roundcube_error.log
  CustomLog ${APACHE_LOG_DIR}/roundcube_access.log combined

  <Directory />
    Options FollowSymLinks
    AllowOverride All
  </Directory>

  <Directory /var/www/html/roundcubemail/>
    Options FollowSymLinks MultiViews
    AllowOverride All
    Order allow,deny
    allow from all
  </Directory>

</VirtualHost>
```

### Roundcube ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓ рж╣рзЛрж╕рзНржЯ рж╕ржХрзНрж░рж┐рзЯ ржХрж░рзБржи ржПржмржВ Apache рж░рж┐рж▓рзЛржб ржХрж░рзБржи

```bash
sudo a2ensite roundcube.conf
sudo systemctl reload apache2
```

### Dovecot ржПржмржВ Postfix ржкрзБржирж░рж╛ржпрж╝ ржЪрж╛рж▓рзБ ржХрж░рзБржи (ржЖржмрж╛рж░)

ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи ржпрзЗ ржирждрзБржи ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи рж╕ржорзНржкрж░рзНржХрзЗ рж╕ржорж╕рзНржд ржкрж░рж┐рж╖рзЗржмрж╛ ржЕржмржЧржд ржЖржЫрзЗред

```bash
sudo systemctl restart dovecot
sudo systemctl restart postfix
```

### ржУрзЯрзЗржм ржЗржирж╕рзНржЯрж▓рж╛рж░рзЗрж░ ржорж╛ржзрзНржпржорзЗ Roundcube ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи рж╕ржорзНржкржирзНржи ржХрж░рзБржи

ржЖржкржирж╛рж░ ржУрзЯрзЗржм ржмрзНрж░рж╛ржЙржЬрж╛рж░ ржЦрзБрж▓рзБржи ржПржмржВ Roundcube ржЗржирж╕рзНржЯрж▓рж╛рж░ URL-ржП ржпрж╛ржи:

`http://mail.paulco.xyz/roundcubemail/installer/`

рж╕рзНржХрзНрж░рж┐ржирзЗ ржжрзЗржЦрж╛ржирзЛ ржирж┐рж░рзНржжрзЗрж╢рж╛ржмрж▓рзА ржЕржирзБрж╕рж░ржг ржХрж░рзБржи:

  * **ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗрж░ ржирж╛ржо (`roundcube`), ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗрж░ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржирж╛ржо (`roundcubeuser`), ржПржмржВ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗрж░ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб (ржЖржкржирж┐ ржпрж╛ рж╕рзЗржЯ ржХрж░рзЗржЫрзЗржи, ржпрзЗржоржи, `ubuntu`) рж╕ржарж┐ржХржнрж╛ржмрзЗ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рждрзЗ ржнрзБрж▓ржмрзЗржи ржирж╛ред**
  * **IMAP** рж╕рзЗржЯрж┐ржВрж╕рзЗ, `localhost` ржПржмржВ ржбрж┐ржлрж▓рзНржЯ ржкрзЛрж░рзНржЯ `143` (ржмрж╛ SSL/TLS ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рж╛ ржерж╛ржХрж▓рзЗ `993`) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред
  * **SMTP** рж╕рзЗржЯрж┐ржВрж╕рзЗ, `localhost` ржПржмржВ ржкрзЛрж░рзНржЯ `25` (ржмрж╛ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг рж╕рж╣ рж╕рж╛ржмржорж┐рж╢ржирзЗрж░ ржЬржирзНржп `587` ржпржжрж┐ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рж╛ ржерж╛ржХрзЗ) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред **ржЖржкрж╛рждржд SMTP рж╕рзЗржЯрж┐ржВрж╕рзЗ ржХрзЛржирзЛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржирж╛ржо/ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж╕рзЗржЯ ржХрж░ржмрзЗржи ржирж╛, ржХрж╛рж░ржг Postfix ржЕржнрзНржпржирзНрждрж░рзАржг ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ ржЬржирзНржп ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржЫрж╛ржбрж╝рж╛ржЗ рж╕рзНржерж╛ржирзАржпрж╝ рж╕рж╛ржмржорж┐рж╢ржирзЗрж░ ржЬржирзНржп ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред**

### ржЗржирж╕рзНржЯрж▓рж╛рж░ ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ ржорзБржЫрзЗ ржлрзЗрж▓рзБржи

рж╕ржлрж▓ ржЗржирж╕рзНржЯрж▓рзЗрж╢ржирзЗрж░ ржкрж░рзЗ, рж╕рзБрж░ржХрзНрж╖рж╛рж░ ржХрж╛рж░ржгрзЗ ржЗржирж╕рзНржЯрж▓рж╛рж░ ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ ржорзБржЫрзЗ ржлрзЗрж▓рж╛ ржЕрждрзНржпржирзНржд ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржгред

```bash
sudo rm -r /var/www/html/roundcubemail/installer/
```

Roundcube ржПрж░ ржорж╛ржзрзНржпржорзЗ ржЗржорзЗрж▓ ржкрж╛ржарж╛ржирзЛ ржПржмржВ ржЧрзНрж░рж╣ржг ржХрж░рж╛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рж╛рж░ ржЖржЧрзЗ, ржЙржмрзБржирзНржЯрзБрждрзЗ ржкрзНрж░рждрж┐ржЯрж┐ ржХрж╛ржЩрзНржХрзНрж╖рж┐ржд ржЗржорзЗрж▓ ржарж┐ржХрж╛ржирж╛рж░ ржЬржирзНржп ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рждрзИрж░рж┐ ржХрж░рждрзЗ `adduser` ржХржорж╛ржирзНржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржорзЗржЗрж▓ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рждрзИрж░рж┐ ржХрж░рждрзЗ ржнрзБрж▓ржмрзЗржи ржирж╛ (ржпрзЗржоржи, `adduser user1`, `adduser user2`)ред

-----

## DNS ржП SPF, DKIM, DMARC рж░рзЗржХрж░рзНржб ржпрзЛржЧ ржХрж░рж╛

ржЗржорзЗрж▓рзЗрж░ ржбрзЗрж▓рж┐ржнрж╛рж░рж┐ржмрж┐рж▓рж┐ржЯрж┐ ржПржмржВ рж╕рзНржкрзНржпрж╛ржо ржкрзНрж░рждрж┐рж░рзЛржз ржХрж░рж╛рж░ ржЬржирзНржп SPF, DKIM ржПржмржВ DMARC ржкрзНрж░ржпрж╝рзЛржЧ ржХрж░рж╛ ржЕрждрзНржпржирзНржд ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржгред ржПржЗ рж░рзЗржХрж░рзНржбржЧрзБрж▓рж┐ ржЖржкржирж╛рж░ ржЖржЙржЯржЧрзЛржпрж╝рж┐ржВ ржЗржорзЗрж▓ржЧрзБрж▓рж┐ржХрзЗ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржХрж░рждрзЗ рж╕рж╣рж╛ржпрж╝рждрж╛ ржХрж░рзЗ, ржпрж╛ рж╕рзЗржЧрзБрж▓рж┐ржХрзЗ рж╕рзНржкрзНржпрж╛ржо рж╣рж┐рж╕рж╛ржмрзЗ ржЪрж┐рж╣рзНржирж┐ржд рж╣ржУржпрж╝рж╛рж░ рж╕ржорзНржнрж╛ржмржирж╛ рж╣рзНрж░рж╛рж╕ ржХрж░рзЗред

**рж░рзЗржлрж╛рж░рзЗржирзНрж╕**: [https://www.linuxbabe.com/mail-server/setting-up-dkim-and-spf](https://www.linuxbabe.com/mail-server/setting-up-dkim-and-spf)

-----

## SPF рж░рзЗржХрж░рзНржб ржХрж┐ржнрж╛ржмрзЗ рж╕рзЗржЯ ржЖржк ржХрж░ржмрзЗржи

**Sender Policy Framework (SPF)** рж╣рж▓ ржПржХржЯрж┐ ржЗржорзЗрж▓ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкржжрзНржзрждрж┐ ржпрж╛ ржЗржорзЗрж▓рзЗрж░ ржЬрж╛рж▓ ржкрзНрж░рзЗрж░ржХрзЗрж░ ржарж┐ржХрж╛ржирж╛ рж╕ржирж╛ржХрзНржд ржХрж░рж╛рж░ ржЬржирзНржп ржбрж┐ржЬрж╛ржЗржи ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред

### ржмрж┐ржжрзНржпржорж╛ржи TXT рж░рзЗржХрж░рзНржб ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи (ржРржЪрзНржЫрж┐ржХ)

ржЖржкржирж┐ `dig` ржмрж╛ `nslookup` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржирзЗрж░ ржмрж┐ржжрзНржпржорж╛ржи TXT рж░рзЗржХрж░рзНржб ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

```bash
dig txt paulco.xyz
```

`nslookup` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ:

```bash
nslookup
> set type=txt
> paulco.xyz
```

### DNS рж╕рж╛рж░рзНржнрж╛рж░рзЗ SPF рж░рзЗржХрж░рзНржб ржпрзЛржЧ ржХрж░рзБржи

ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржирзЗрж░ DNS рж╕рзЗржЯрж┐ржВрж╕рзЗ ржПржХржЯрж┐ TXT рж░рзЗржХрж░рзНржб ржпрзЛржЧ ржХрж░рждрзЗ рж╣ржмрзЗред ржПржЯрж┐ ржЖржкржирж╛рж░ рж╕рзНржерж╛ржирзАржпрж╝ DNS рж╕рж╛рж░рзНржнрж╛рж░рзЗ (ржпржжрж┐ ржЖржкржирж┐ ржПржХржЯрж┐ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░ржЫрзЗржи) ржЕржержмрж╛ ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржи рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж╛рж░рзЗрж░ DNS ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ ржкрзНржпрж╛ржирзЗрж▓рзЗрж░ ржорж╛ржзрзНржпржорзЗ ржХрж░рж╛ ржпрзЗрждрзЗ ржкрж╛рж░рзЗред

**`nano /etc/bind/forward.zone` ржПрж░ ржЙржжрж╛рж╣рж░ржг (ржпржжрж┐ Bind9 ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржи):**

```
@  IN  TXT "v=spf1 a mx ip4:202.4.111.69 ~all"
```

**ржбрзЛржорзЗржЗржи ржкрзНржпрж╛ржирзЗрж▓рзЗрж░ ржЙржжрж╛рж╣рж░ржг:**

ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржи ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржбрзЗ (ржпрзЗржоржи, Namecheap, GoDaddy, Cloudflare) ржпрж╛ржи -\> DNS ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ -\> ржПржХржЯрж┐ ржирждрзБржи TXT рж░рзЗржХрж░рзНржб ржпрзЛржЧ ржХрж░рзБржи:

  * **Type**: `TXT`
  * **Host/Name**: `@` (ржЕржержмрж╛ рж░рзБржЯ ржбрзЛржорзЗржЗржирзЗрж░ ржЬржирзНржп ржЦрж╛рж▓рж┐ рж░рж╛ржЦрзБржи)
  * **Value/Text**: `"v=spf1 a mx ip4:202.4.111.69 ~all"`
  * **TTL**: `Auto` ржЕржержмрж╛ `3600` (рж╕рзЗржХрзЗржирзНржб)

**SPF рж░рзЗржХрж░рзНржбрзЗрж░ ржмрзНржпрж╛ржЦрзНржпрж╛:**

  * `v=spf1`: SPF рж╕ржВрж╕рзНржХрж░ржг ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж░рзЗред
  * `a`: ржбрзЛржорзЗржЗржирзЗрж░ A рж░рзЗржХрж░рзНржбржХрзЗ ржЗржорзЗрж▓ ржкрж╛ржарж╛ржирзЛрж░ ржЕржирзБржорждрж┐ ржжрзЗржпрж╝ред
  * `mx`: ржбрзЛржорзЗржЗржирзЗрж░ MX рж░рзЗржХрж░рзНржбржЧрзБрж▓рж┐ржХрзЗ ржЗржорзЗрж▓ ржкрж╛ржарж╛ржирзЛрж░ ржЕржирзБржорждрж┐ ржжрзЗржпрж╝ред
  * `ip4:202.4.111.69`: рж╕рзНржкрж╖рзНржЯржнрж╛ржмрзЗ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ IPv4 ржЕрзНржпрж╛ржбрзНрж░рзЗрж╕ржХрзЗ ржЗржорзЗрж▓ ржкрж╛ржарж╛ржирзЛрж░ ржЕржирзБржорждрж┐ ржжрзЗржпрж╝ред `202.4.111.69` ржПрж░ ржЬрж╛ржпрж╝ржЧрж╛ржпрж╝ ржЖржкржирж╛рж░ ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржкрж╛ржмрж▓рж┐ржХ ржЖржЗржкрж┐ ржЕрзНржпрж╛ржбрзНрж░рзЗрж╕ ржмрж╕рж╛ржиред
  * `~all`: ржПржХржЯрж┐ "рж╕ржлржЯржлрзЗржЗрж▓" ржорзЗржХрж╛ржирж┐ржЬржо, ржпрж╛рж░ ржЕрж░рзНрже ржЕржирзНржпрж╛ржирзНржп ржЙрзОрж╕ ржерзЗржХрзЗ ржЖрж╕рж╛ ржЗржорзЗрж▓ржЧрзБрж▓рж┐ ржмрзИржз рж╣рждрзЗ ржкрж╛рж░рзЗ, рждржмрзЗ рж╕рзЗржЧрзБрж▓рж┐ржХрзЗ рж╕ржирзНржжрзЗрж╣рзЗрж░ ржЪрзЛржЦрзЗ ржжрзЗржЦрж╛ ржЙржЪрж┐рждред ржХржарзЛрж░ ржирзАрждрж┐рж░ ржЬржирзНржп, ржЖржкржирж┐ `-all` (рж╣рж╛рж░рзНржбржлрзЗржЗрж▓) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи, рждржмрзЗ ржкрзНрж░рж╛ржержорж┐ржХржнрж╛ржмрзЗ `~all` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛рж░ ржХрзНрж╖рзЗрждрзНрж░рзЗ рж╕рждрж░рзНржХ ржерж╛ржХрзБржиред

### SPF рж░рзЗржХрж░рзНржб ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи

рж░рзЗржХрж░рзНржб ржпрзЛржЧ ржХрж░рж╛рж░ ржкрж░, ржПржЯрж┐ржХрзЗ ржкрзНрж░ржЪрж╛рж░рзЗрж░ ржЬржирзНржп ржХрж┐ржЫрзБ рж╕ржоржпрж╝ ржжрж┐ржи (DNS ржкрзНрж░ржЪрж╛рж░ ржХржпрж╝рзЗржХ ржорж┐ржирж┐ржЯ ржерзЗржХрзЗ ржХржпрж╝рзЗржХ ржШржирзНржЯрж╛ ржкрж░рзНржпржирзНржд рж╕ржоржпрж╝ ржирж┐рждрзЗ ржкрж╛рж░рзЗ)ред рждрж╛рж░ржкрж░, `dig` ржмрж╛ `nslookup` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЖржмрж╛рж░ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржиред

-----

### ржРржЪрзНржЫрж┐ржХ: SPF ржкрж▓рж┐рж╕рж┐ ржПржЬрзЗржирзНржЯ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рж╛ (Postfix-policyd-spf-python)

Postfix ржПрж░ ржЬржирзНржп ржПржЗ ржкрж▓рж┐рж╕рж┐ ржПржЬрзЗржирзНржЯ SPF ржЪрзЗржХ ржмрзНржпрж░рзНрже рж╣ржУрзЯрж╛ ржЗржиржХрж╛ржорж┐ржВ ржЗржорзЗрж▓ ржкрзНрж░рждрзНржпрж╛ржЦрзНржпрж╛ржи ржХрж░рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗред

```bash
sudo apt install postfix-policyd-spf-python -y
```

Postfix ржорж╛рж╕рзНржЯрж╛рж░ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ржЯрж┐ ржПржбрж┐ржЯ ржХрж░рзБржи:

```bash
sudo nano /etc/postfix/master.cf
```

ржлрж╛ржЗрж▓рзЗрж░ рж╢рзЗрж╖рзЗ ржирж┐ржЪрзЗрж░ рж▓рж╛ржЗржиржЧрзБрж▓рзЛ ржпрзЛржЧ ржХрж░рзБржи:

```
policyd-spf  unix  -       n       n       -       0       spawn
  user=policyd-spf argv=/usr/bin/policyd-spf
```

ржлрж╛ржЗрж▓ржЯрж┐ рж╕рзЗржн ржХрж░рзБржи ржПржмржВ ржмржирзНржз ржХрж░рзБржиред ржПрж░ржкрж░, Postfix ржПрж░ ржкрзНрж░ржзрж╛ржи ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ржЯрж┐ ржПржбрж┐ржЯ ржХрж░рзБржи:

```bash
sudo nano /etc/postfix/main.cf
```

ржлрж╛ржЗрж▓рзЗрж░ рж╢рзЗрж╖рзЗ ржирж┐ржЪрзЗрж░ рж▓рж╛ржЗржиржЧрзБрж▓рзЛ ржпрзЛржЧ ржХрж░рзБржи:

```
policyd-spf_time_limit = 3600
smtpd_recipient_restrictions =
  permit_mynetworks,
  permit_sasl_authenticated,
  reject_unauth_destination,
  check_policy_service unix:private/policyd-spf
```

ржлрж╛ржЗрж▓ржЯрж┐ рж╕рзЗржн ржХрж░рзБржи ржПржмржВ ржмржирзНржз ржХрж░рзБржиред рждрж╛рж░ржкрж░ Postfix рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзБржи:

```bash
sudo systemctl restart postfix
```

ржПрж░ ржкрж░, ржпржЦржи ржЖржкржирж┐ ржПржХржЯрж┐ SPF рж░рзЗржХрж░рзНржб ржЖржЫрзЗ ржПржоржи ржбрзЛржорзЗржЗржи ржерзЗржХрзЗ ржПржХржЯрж┐ ржЗржорзЗрж▓ ржкрж╛ржмрзЗржи, ржЖржкржирж┐ ржХрж╛ржБржЪрж╛ ржЗржорзЗрж▓ рж╣рзЗржбрж╛рж░-ржП SPF ржЪрзЗржХ ржлрж▓рж╛ржлрж▓ ржжрзЗржЦрждрзЗ ржкрж╛рж░ржмрзЗржи, ржЙржжрж╛рж╣рж░ржгрж╕рзНржмрж░рзВржк:

`Received-SPF: Pass (sender SPF authorized).`

-----

## DMARC рж░рзЗржХрж░рзНржб ржХрж┐ржнрж╛ржмрзЗ рж╕рзЗржЯ ржЖржк ржХрж░ржмрзЗржи

**Domain-based Message Authentication, Reporting, and Conformance (DMARC)** ржПржХржЯрж┐ ржЗржорзЗрж▓ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрзНрж░рзЛржЯрзЛржХрж▓ ржпрж╛ SPF ржПржмржВ DKIM ржПрж░ ржЙржкрж░ ржнрж┐рждрзНрждрж┐ ржХрж░рзЗ рждрзИрж░рж┐ред ржПржЯрж┐ ржбрзЛржорзЗржЗржи ржорж╛рж▓рж┐ржХржжрзЗрж░ ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛ ржжрзЗрзЯ ржпрзЗ SPF ржмрж╛ DKIM ржЪрзЗржХ ржмрзНржпрж░рзНрже рж╣рж▓рзЗ рждрж╛ржжрзЗрж░ ржЗржорзЗрж▓ржЧрзБрж▓рж┐ ржХрзАржнрж╛ржмрзЗ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛ ржЙржЪрж┐ржд ржПржмржВ ржЗржорзЗрж▓ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржмрзНржпрж░рзНржерждрж╛рж░ ржЙржкрж░ рж░рж┐ржкрзЛрж░рзНржЯ ржЧрзНрж░рж╣ржг ржХрж░рж╛рж░ ржЕржирзБржорждрж┐ ржжрзЗржпрж╝ред

### ржбрзЛржорзЗржЗржи ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржбрзЗ DMARC рж░рзЗржХрж░рзНржб ржпрзЛржЧ ржХрж░рзБржи

ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржи ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржбрзЗ (ржпрзЗржоржи, Namecheap, GoDaddy, Cloudflare) ржпрж╛ржи -\> DNS ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ -\> ржПржХржЯрж┐ ржирждрзБржи TXT рж░рзЗржХрж░рзНржб ржпрзЛржЧ ржХрж░рзБржи:

  * **Type**: `TXT`
  * **Host/Name**: `_dmarc`
  * **Value/Text**: `v=DMARC1; p=quarantine; aspf=r; sp=none; rua=mailto:your_email@paulco.xyz; ruf=mailto:your_email@paulco.xyz`
      * **ржмрзНржпрж╛ржЦрзНржпрж╛:**
          * `v=DMARC1`: DMARC рж╕ржВрж╕рзНржХрж░ржг ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж░рзЗред
          * `p=quarantine`: DMARC ржЪрзЗржХ ржмрзНржпрж░рзНрже рж╣ржУржпрж╝рж╛ ржЗржорзЗрж▓ржЧрзБрж▓рж┐рж░ ржЬржирзНржп ржирзАрждрж┐ред `quarantine` ржорж╛ржирзЗ ржкрзНрж░рж╛ржкржХржжрзЗрж░ рждрж╛ржжрзЗрж░ рж╕ржирзНржжрзЗрж╣ржЬржиржХ рж╣рж┐рж╕рж╛ржмрзЗ ржмрж┐ржмрзЗржЪржирж╛ ржХрж░рж╛ ржЙржЪрж┐ржд (ржпрзЗржоржи, рж╕рзНржкрзНржпрж╛ржо ржлрзЛрж▓рзНржбрж╛рж░рзЗ рж╕рж░рж╛ржирзЛ)ред ржЕржирзНржпрж╛ржирзНржп ржмрж┐ржХрж▓рзНржк рж╣рж▓ `none` (рж╢рзБржзрзБржорж╛рждрзНрж░ ржоржирж┐ржЯрж░, ржХрзЛржирзЛ ржЕрзНржпрж╛ржХрж╢ржи ржирзЗржЗ) ржПржмржВ `reject` (рж╕ржорзНржкрзВрж░рзНржгржнрж╛ржмрзЗ ржкрзНрж░рждрзНржпрж╛ржЦрзНржпрж╛ржи)ред ржкрзНрж░рж╛ржержорж┐ржХржнрж╛ржмрзЗ `none` ржмрж╛ `quarantine` ржжрж┐ржпрж╝рзЗ рж╢рзБрж░рзБ ржХрж░рзБржи ржПржмржВ ржирж┐рж╢рзНржЪрж┐ржд рж╣рж▓рзЗ `reject` ржП ржпрж╛ржиред
          * `aspf=r`: SPF ржПрж░ ржЬржирзНржп ржЕрзНржпрж╛рж▓рж╛ржЗржиржорзЗржирзНржЯ ржорзЛржбред `r` ржорж╛ржирзЗ рж░рж┐рж▓рзНржпрж╛ржХрзНрж╕ржб ржЕрзНржпрж╛рж▓рж╛ржЗржиржорзЗржирзНржЯред
          * `sp=none`: рж╕рж╛ржмржбрзЛржорзЗржиржЧрзБрж▓рж┐рж░ ржЬржирзНржп ржирзАрждрж┐ред `none` ржорж╛ржирзЗ рж╕рж╛ржмржбрзЛржорзЗржиржЧрзБрж▓рж┐рж░ ржЬржирзНржп ржХрзЛржирзЛ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржирзАрждрж┐ ржирзЗржЗ, рждрж╛рж░рж╛ ржорзВрж▓ ржбрзЛржорзЗржЗржирзЗрж░ ржирзАрждрж┐ ржЙрждрзНрждрж░рж╛ржзрж┐ржХрж╛рж░ рж╕рзВрждрзНрж░рзЗ ржкрж╛ржпрж╝ред
          * `rua=mailto:your_email@paulco.xyz`: рж╕ржорж╖рзНржЯрж┐ржЧржд DMARC рж░рж┐ржкрзЛрж░рзНржЯ ржкрж╛ржарж╛ржирзЛрж░ ржЬржирзНржп ржЗржорзЗрж▓ ржарж┐ржХрж╛ржирж╛ред **`your_email@paulco.xyz` ржХрзЗ ржПржХржЯрж┐ ржЖрж╕рж▓ ржЗржорзЗрж▓ ржарж┐ржХрж╛ржирж╛ ржжрж┐ржпрж╝рзЗ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи ржХрж░рзБржи ржпрзЗржЦрж╛ржирзЗ ржЖржкржирж┐ рж░рж┐ржкрзЛрж░рзНржЯ ржкрзЗрждрзЗ ржЪрж╛ржиред**
          * `ruf=mailto:your_email@paulco.xyz`: ржлрж░рзЗржирж╕рж┐ржХ (ржмрзНржпрж░рзНржерждрж╛) DMARC рж░рж┐ржкрзЛрж░рзНржЯ ржкрж╛ржарж╛ржирзЛрж░ ржЬржирзНржп ржЗржорзЗрж▓ ржарж┐ржХрж╛ржирж╛ред **`your_email@paulco.xyz` ржХрзЗ ржПржХржЯрж┐ ржЖрж╕рж▓ ржЗржорзЗрж▓ ржарж┐ржХрж╛ржирж╛ ржжрж┐ржпрж╝рзЗ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи ржХрж░рзБржиред**

-----

## DKIM рж░рзЗржХрж░рзНржб ржХрж┐ржнрж╛ржмрзЗ рж╕рзЗржЯ ржЖржк ржХрж░ржмрзЗржи

**DomainKeys Identified Mail (DKIM)** ржПржХржЯрж┐ ржЗржорзЗрж▓ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкржжрзНржзрждрж┐ ржпрж╛ ржиржХрж▓ ржкрзНрж░рзЗрж░ржХрзЗрж░ ржарж┐ржХрж╛ржирж╛ рж╕ржирж╛ржХрзНржд ржХрж░рж╛рж░ ржЬржирзНржп ржбрж┐ржЬрж╛ржЗржи ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред DKIM ржкрзНрж░рж╛ржкржХржХрзЗ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рждрзЗ ржжрзЗржпрж╝ ржпрзЗ ржПржХржЯрж┐ ржЗржорзЗрж▓ ржЖрж╕рж▓рзЗ ржЙрж▓рзНрж▓рж┐ржЦрж┐ржд ржбрзЛржорзЗржЗржи ржерзЗржХрзЗ ржкрж╛ржарж╛ржирзЛ рж╣ржпрж╝рзЗржЫрзЗ ржХрж┐ржирж╛ред

### OpenDKIM ржПржмржВ OpenDKIM ржЯрзБрж▓рж╕ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

```bash
sudo apt-get install opendkim opendkim-tools -y
```

### OpenDKIM рж╕рж╛рж░рзНржнрж┐рж╕ ржЪрж╛рж▓рзБ ржПржмржВ рж╕ржХрзНрж░рж┐рзЯ ржХрж░рзБржи

```bash
sudo systemctl start opendkim
sudo systemctl enable opendkim
```

### OpenDKIM ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ рждрзИрж░рж┐ ржХрж░рзБржи

```bash
mkdir /etc/opendkim
```

### DKIM ржХрзА рждрзИрж░рж┐ ржХрж░рзБржи

ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржирзЗрж░ ржЬржирзНржп ржкрзНрж░рж╛ржЗржнрзЗржЯ ржПржмржВ ржкрж╛ржмрж▓рж┐ржХ DKIM ржХрзА рждрзИрж░рж┐ ржХрж░рзБржиред `paulco.xyz` ржПрж░ ржЬрж╛рзЯржЧрж╛рзЯ ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржи ржмрж╕рж╛ржиред

```bash
opendkim-genkey -D /etc/opendkim/ --domain paulco.xyz --selector mail
```

ржПржЗ ржХржорж╛ржирзНржбржЯрж┐ ржжрзБржЯрж┐ ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░ржмрзЗ: `mail.private` (ржЖржкржирж╛рж░ ржкрзНрж░рж╛ржЗржнрзЗржЯ ржХрзА) ржПржмржВ `mail.txt` (ржЖржкржирж╛рж░ ржкрж╛ржмрж▓рж┐ржХ ржХрзА, ржпрж╛ DNS рж░рзЗржХрж░рзНржбрзЗ ржпрзЛржЧ ржХрж░рждрзЗ рж╣ржмрзЗ)ред

### DKIM ржкрж╛ржмрж▓рж┐ржХ ржХрзА ржжрзЗржЦрзБржи

ржЖржкржирж╛рж░ ржкрж╛ржмрж▓рж┐ржХ ржХрзА ржлрж╛ржЗрж▓рзЗрж░ ржмрж┐рж╖ржпрж╝ржмрж╕рзНрждрзБ ржкрзНрж░ржжрж░рзНрж╢ржи ржХрж░рзБржиред DNS рж░рзЗржХрж░рзНржбрзЗрж░ ржЬржирзНржп ржЖржкржирж╛рж░ ржПржЗ рждржерзНржпрзЗрж░ ржкрзНрж░ржпрж╝рзЛржЬржи рж╣ржмрзЗред

```bash
cat /etc/opendkim/mail.txt
```

ржЖржЙржЯржкрзБржЯржЯрж┐ ржжрзЗржЦрждрзЗ ржирж┐ржЪрзЗрж░ ржорждрзЛ рж╣ржмрзЗ:

```
mail._domainkey IN TXT ( "v=DKIM1; h=sha256; k=rsa; "
          "p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqm42/tBAcceewB+FTl5SWVUT0Xa80QZfBBjP4xP16xRJo7YsOoaB9DZlVehNbZxPBJLhDiJdEyV9nDODqABroInlLM0pT2pRGHcXoiamU5tSzWWMWfd8d4kOZZgSeDyJk89+XNHMZeKRX45fJBdxzWVmaFRljxnEz90496aYScyr8WFGSUHCtZD1n2Rq/8O6u8Q8HJKoHfV2fJ"
          "/ZQxN3Z2uUGWBjvB1fjaszHr/iZpsbMRTQM9gAxLI1xmtgs1k4jQua+deZWCLzylLeOW05/itDz87psLBOAZsqH2yh+x6FY1Mf2jGaROV0nSBY0Nf2JyY05FOVB0JgvOEKL569jwIDAQAB" )  ; ----- DKIM key mail for paulco.xyz
```

**ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг**: ржПржЯрж┐ ржЖржкржирж╛рж░ DNS ржП ржпрзЛржЧ ржХрж░рж╛рж░ рж╕ржоржпрж╝, ржЙржжрзНржзрзГрждрж┐ ржЪрж┐рж╣рзНржи, ржмржирзНржзржирзА ржПржмржВ ржирждрзБржи рж▓рж╛ржЗржиржЧрзБрж▓рж┐ рж╕рж░рж┐ржпрж╝рзЗ ржжрж┐ржи ржпрж╛рждрзЗ ржПржЯрж┐ ржПржХржЯрж┐ ржПржХржХ ржзрж╛рж░рж╛ржмрж╛рж╣рж┐ржХ рж╕рзНржЯрзНрж░рж┐ржВ рж╣ржпрж╝ред

**DNS ржПржирзНржЯрзНрж░рж┐рж░ ржЬржирзНржп ржПржЯрж┐ ржХрзЗржоржи рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд рждрж╛рж░ ржЙржжрж╛рж╣рж░ржг (ржПржХржХ рж▓рж╛ржЗржи, ржХрзЛржирзЛ ржЙржжрзНржзрзГрждрж┐ ржЪрж┐рж╣рзНржи ржирзЗржЗ, ржХрзЛржирзЛ ржЕрждрж┐рж░рж┐ржХрзНржд рж╕рзНржерж╛ржи ржирзЗржЗ):**

```
v=DKIM1; h=sha256; k=rsa; p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqm42/tBAcceewB+FTl5SWVUT0Xa80QZfBBjP4xP16xRJo7YsOoaB9DZlVehNbZxPBJLhDiJdEyV9nDODqABroInlLM0pT2pRGHcXoiamU5tSzWWMWfd8d4kOZZgSeDyJk89+XNHMZeKRX45fJBdxzWVmaFRljxnEz90496aYScyr8WFGSUHCtZD1n2Rq/8O6u8Q8HJKoHfV2fJ/ZQxN3Z2uUGWBjvB1fjaszHr/iZpsbMRTQM9gAxLI1xmtgs1k4jQua+deZWCLzylLeOW05/itDz87psLBOAZsqH2yh+x6FY1Mf2jGaROV0nSBY0Nf2JyY05FOVB0JgvOEKL569jwIDAQAB
```

### DNS ржП DKIM рж░рзЗржХрж░рзНржб ржпрзЛржЧ ржХрж░рзБржи

ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржи ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржбрзЗ ржпрж╛ржи -\> DNS ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ -\> ржПржХржЯрж┐ ржирждрзБржи TXT рж░рзЗржХрж░рзНржб ржпрзЛржЧ ржХрж░рзБржи:

  * **Type**: `TXT`
  * **Host/Name**: `mail._domainkey` (ржЖржкржирж┐ ржпрзЗ рж╕рж┐рж▓рзЗржХрзНржЯрж░ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржЫрзЗржи, рждрж╛рж░ ржкрж░рзЗ `._domainkey`)
  * **Value/Text**: ржЖржкржирж┐ ржЙржкрж░рзЗ ржлрж░ржорзНржпрж╛ржЯ ржХрж░рж╛ ржПржХржХ-рж▓рж╛ржЗржирзЗрж░ ржкрж╛ржмрж▓рж┐ржХ ржХрзА рж╕рзНржЯрзНрж░рж┐ржВржЯрж┐ ржкрзЗрж╕рзНржЯ ржХрж░рзБржиред
  * **TTL**: `Auto` ржЕржержмрж╛ `3600`

### OpenDKIM ржбрж┐рж░рзЗржХрзНржЯрж░рж┐рж░ ржорж╛рж▓рж┐ржХрж╛ржирж╛ рж╕рзЗржЯ ржХрж░рзБржи

```bash
sudo chown -R opendkim:opendkim /etc/opendkim
```

### OpenDKIM ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

OpenDKIM ржПрж░ ржкрзНрж░ржзрж╛ржи ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ржЯрж┐ ржПржбрж┐ржЯ ржХрж░рзБржиред

```bash
sudo nano /etc/opendkim.conf
```

ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи ржпрзЗ ржирж┐ржЪрзЗрж░ рж▓рж╛ржЗржиржЧрзБрж▓рзЛ ржЖржиржХржорзЗржирзНржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ ржЕржержмрж╛ ржжрзЗржЦрж╛ржирзЛ ржЕржирзБржпрж╛ржпрж╝рзА ржпрзЛржЧ/ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ:

```
AutoRestart Yes
AutoRestartRate 10/1M
Umask 002
Syslog yes
SyslogSuccess Yes
LogWhy Yes
Mode sv
Canonicalization relaxed/simple
UserID opendkim:opendkim
Socket inet:8891@localhost
PidFile /var/run/opendkim/opendkim.pid
ExternalIgnoreList refile:/etc/opendkim/TrustedHosts
InternalHosts refile:/etc/opendkim/TrustedHosts
KeyTable refile:/etc/opendkim/KeyTable
SigningTable refile:/etc/opendkim/SigningTable
SignatureAlgorithm rsa-sha256
```

### ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржиржХрзЗ ржЯрзНрж░рж╛рж╕рзНржЯрзЗржб рж╣рзЛрж╕рзНржЯ рж╣рж┐рж╕рж╛ржмрзЗ ржпрзЛржЧ ржХрж░рзБржи

OpenDKIM ржПрж░ ржЬржирзНржп `TrustedHosts` ржлрж╛ржЗрж▓ржЯрж┐ рждрзИрж░рж┐ ржмрж╛ ржПржбрж┐ржЯ ржХрж░рзБржиред

```bash
sudo nano /etc/opendkim/TrustedHosts
```

ржПржЗ ржлрж╛ржЗрж▓рзЗ ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржи ржПржмржВ `localhost` (ржЕржержмрж╛ ржпрзЗ ржХрзЛржирзЛ ржЕржнрзНржпржирзНрждрж░рзАржг ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ ржпрж╛ ржЗржорзЗрж▓ ржкрж╛ржарж╛ржмрзЗ) ржпрзЛржЧ ржХрж░рзБржи:

```
127.0.0.1
localhost
.paulco.xyz
```

### ржХрзА ржЯрзЗржмрж┐рж▓ рж╕ржВржЬрзНржЮрж╛ржпрж╝рж┐ржд ржХрж░рзБржи

`KeyTable` ржлрж╛ржЗрж▓ржЯрж┐ рждрзИрж░рж┐ ржмрж╛ ржПржбрж┐ржЯ ржХрж░рзБржи, ржпрж╛ ржкрзНрж░рж╛ржЗржнрзЗржЯ ржХрзАржЧрзБрж▓рж┐рж░ рж╕рж╛ржерзЗ рж╕рж┐рж▓рзЗржХрзНржЯрж░ржЧрзБрж▓рж┐ржХрзЗ ржорзНржпрж╛ржк ржХрж░рзЗред

```bash
sudo nano /etc/opendkim/KeyTable
```

ржирж┐ржЪрзЗрж░ рж▓рж╛ржЗржиржЯрж┐ ржпрзЛржЧ ржХрж░рзБржи:

```
mail._domainkey.paulco.xyz paulco.xyz:mail:/etc/opendkim/mail.private
```

### рж╕рж╛ржЗржирж┐ржВ ржЯрзЗржмрж┐рж▓ рж╕ржВржЬрзНржЮрж╛ржпрж╝рж┐ржд ржХрж░рзБржи

`SigningTable` ржлрж╛ржЗрж▓ржЯрж┐ рждрзИрж░рж┐ ржмрж╛ ржПржбрж┐ржЯ ржХрж░рзБржи, ржпрж╛ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж░рзЗ ржХрзЛржи ржбрзЛржорзЗржЗржиржЧрзБрж▓рж┐ржХрзЗ ржХрзЛржи ржХрзА ржжрж┐ржпрж╝рзЗ рж╕рзНржмрж╛ржХрзНрж╖рж░ ржХрж░рж╛ ржЙржЪрж┐рждред

```bash
sudo nano /etc/opendkim/SigningTable
```

ржирж┐ржЪрзЗрж░ рж▓рж╛ржЗржиржЧрзБрж▓рзЛ ржпрзЛржЧ ржХрж░рзБржи:

```
*@paulco.xyz mail._domainkey.paulco.xyz
*@*.paulco.xyz mail._domainkey.paulco.xyz
```

### OpenDKIM ржПржмржВ Postfix рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзБржи

OpenDKIM ржкрж░рж┐ржмрж░рзНрждржиржЧрзБрж▓рж┐ ржкрзНрж░ржпрж╝рзЛржЧ ржХрж░рзБржи ржПржмржВ ржЙржнржпрж╝ ржкрж░рж┐рж╖рзЗржмрж╛ ржкрзБржирж░рж╛ржпрж╝ ржЪрж╛рж▓рзБ ржХрж░рзБржиред

```bash
sudo systemctl restart opendkim
sudo systemctl restart postfix
```

-----

### DKIM рж░рзЗржХрж░рзНржб ржПржмржВ ржорзЗржЗрж▓ ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи

### ржЯрж╛рж░рзНржорж┐ржирж╛рж▓рзЗ DKIM ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи

ржЖржкржирж┐ `opendkim-testkey` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЖржкржирж╛рж░ DKIM рж░рзЗржХрж░рзНржб ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи:

```bash
sudo opendkim-testkey -d paulco.xyz -s mail -vvv
```

ржЖржкржирж╛рж░ DNS рж░рзЗржХрж░рзНржб ржПржмржВ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи рж╕ржарж┐ржХ рж╣рж▓рзЗ ржПржЯрж┐ `Key OK` ржЖржЙржЯржкрзБржЯ ржжрзЗржЦрж╛ржмрзЗред

### ржЕржирж▓рж╛ржЗржи ржЯрзБрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ DKIM ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи

ржЕржирж▓рж╛ржЗржи ржЯрзБрж▓ржЧрзБрж▓рж┐ ржЖржкржирж╛рж░ DKIM рж░рзЗржХрж░рзНржб ржпрж╛ржЪрж╛ржЗ ржХрж░рждрзЗ рж╕рж╣рж╛ржпрж╝рждрж╛ ржХрж░рждрзЗ ржкрж╛рж░рзЗред

  * ржнрж┐ржЬрж┐ржЯ ржХрж░рзБржи: [https://dmarcian.com/dkim-inspector/](https://dmarcian.com/dkim-inspector/)
  * ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржи (`paulco.xyz`) ржПржмржВ рж╕рж┐рж▓рзЗржХрзНржЯрж░ (`mail`) рж▓рж┐ржЦрзБржиред

### ржорзЗржЗрж▓ ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи

ржЖржкржирж╛рж░ ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ SPF, DKIM, ржПржмржВ DMARC ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржкрзБржЩрзНржЦрж╛ржирзБржкрзБржЩрзНржЦржнрж╛ржмрзЗ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рждрзЗ, Mail-Tester ржПрж░ ржорждрзЛ ржПржХржЯрж┐ рж╕рзЗржмрж╛ржпрж╝ ржПржХржЯрж┐ ржкрж░рзАржХрзНрж╖рж╛ ржЗржорзЗрж▓ ржкрж╛ржарж╛ржиред

  * ржнрж┐ржЬрж┐ржЯ ржХрж░рзБржи: [https://www.mail-tester.com/](https://www.mail-tester.com/)
  * Mail-Tester ржжрзНржмрж╛рж░рж╛ ржкрзНрж░ржжрждрзНржд ржЕржиржирзНржп ржЗржорзЗрж▓ ржарж┐ржХрж╛ржирж╛ржЯрж┐ ржХржкрж┐ ржХрж░рзБржиред
  * ржЖржкржирж╛рж░ ржирждрзБржи ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рж╛ ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░ ржерзЗржХрзЗ ржПржЗ ржарж┐ржХрж╛ржирж╛ржпрж╝ ржПржХржЯрж┐ ржкрж░рзАржХрзНрж╖рж╛ ржЗржорзЗрж▓ ржкрж╛ржарж╛ржи (ржЙржжрж╛рж╣рж░ржгрж╕рзНржмрж░рзВржк, Roundcube ржмрж╛ `mail` ржХржорж╛ржирзНржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ)ред

<!-- end list -->

```bash
echo "Hey, I am dev stack. I want to connect with you sumon" | mail -s "Connected Mail" sumonpaul267@gmail.com
```

  * Mail-Tester-ржП ржлрж┐рж░рзЗ ржпрж╛ржи ржПржмржВ ржЖржкржирж╛рж░ рж╕рзНржХрзЛрж░ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржиред ржнрж╛рж▓ ржбрзЗрж▓рж┐ржнрж╛рж░рж┐ржмрж┐рж▓рж┐ржЯрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рждрзЗ ржПржХржЯрж┐ ржЙржЪрзНржЪ рж╕рзНржХрзЛрж░ (рж╕рж╛ржзрж╛рж░ржгржд 9/10 ржмрж╛ 10/10) рж▓ржХрзНрж╖рзНржп ржХрж░рзБржиред

-----

## ржЙржкрж╕ржВрж╣рж╛рж░

ржЖржкржирж┐ рж╕ржлрж▓ржнрж╛ржмрзЗ Postfix, Dovecot ржПржмржВ Roundcube ржЗржирж╕рзНржЯрж▓ ржУ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзЗржЫрзЗржи, ржпрж╛ ржЖржкржирж╛рж░ ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░ржХрзЗ ржХрж╛рж░рзНржпржХрж░рзА ржХрж░рзЗржЫрзЗред ржЖржкржирж┐ SPF, DKIM, ржПржмржВ DMARC-ржПрж░ ржорждрзЛ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ DNS рж░рзЗржХрж░рзНржбржЧрзБрж▓рж┐ржУ ржкрзНрж░ржпрж╝рзЛржЧ ржХрж░рзЗржЫрзЗржи ржпрж╛ ржЗржорзЗрж▓рзЗрж░ ржбрзЗрж▓рж┐ржнрж╛рж░рж┐ржмрж┐рж▓рж┐ржЯрж┐ ржЙржирзНржиржд ржХрж░рждрзЗ ржПржмржВ рж╕рзНржкрзНржпрж╛ржо ржкрзНрж░рждрж┐рж░рзЛржз ржХрж░рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗред

ржПржЗ рж╕рзЗржЯржЖржкрзЗрж░ ржорж╛ржзрзНржпржорзЗ, ржПржЦржи ржЖржкржирж╛рж░ ржХрж╛ржЫрзЗ ржПржХржЯрж┐ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА, рж╕рзНржм-рж╣рзЛрж╕рзНржЯ ржХрж░рж╛ ржЗржорзЗрж▓ рж╕ржорж╛ржзрж╛ржи рж░ржпрж╝рзЗржЫрзЗред ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░ ржПржмржВ рж╕ржлржЯржУрзЯрзНржпрж╛рж░ ржирж┐ржпрж╝ржорж┐ржд ржЖржкржбрзЗржЯ ржХрж░рждрзЗ ржПржмржВ ржпрзЗржХрзЛржирзЛ рж╕ржорж╕рзНржпрж╛рж░ ржЬржирзНржп ржЖржкржирж╛рж░ ржорзЗржЗрж▓ рж▓ржЧржЧрзБрж▓рж┐ ржирж┐рж░рзАржХрзНрж╖ржг ржХрж░рждрзЗ ржнрзБрж▓ржмрзЗржи ржирж╛ред

ржЖржкржирж┐ ржХрж┐ ржкрж░ржмрж░рзНрждрзАрждрзЗ ржЖржкржирж╛рж░ ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░ржХрзЗ SSL/TLS ржжрж┐ржпрж╝рзЗ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржХрж░рждрзЗ, ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржПржмржВ ржбрзЛржорзЗржЗржи ржпрзЛржЧ ржХрж░рждрзЗ, ржирж╛ржХрж┐ ржХрж░рзНржоржХрзНрж╖ржорждрж╛ ржЖрж░ржУ ржЕржкрзНржЯрж┐ржорж╛ржЗржЬ ржХрж░рждрзЗ ржЪрж╛ржи?
