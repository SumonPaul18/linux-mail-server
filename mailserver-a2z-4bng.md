# ЁЯУз рж╕ржорзНржкрзВрж░рзНржг ржЧрж╛ржЗржб: ржЙржмрзБржирзНржЯрзБрждрзЗ Postfix, Dovecot ржПржмржВ Roundcube ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж▓рж┐ржирж╛ржХрзНрж╕ ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

ржПржЗ ржЧрж╛ржЗржбржЯрж┐ ржЖржкржирж╛ржХрзЗ ржЙржмрзБржирзНржЯрзБрждрзЗ ржПржХржЯрж┐ **рж╕ржорзНржкрзВрж░рзНржг ржХрж╛рж░рзНржпржХрж░, ржкрзНрж░рзЛржбрж╛ржХрж╢ржи-рж░рзЗржбрж┐ ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░** рж╕рзЗржЯ ржЖржк ржХрж░рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░ржмрзЗ **Postfix (SMTP)**, **Dovecot (IMAP/POP3)**, ржПржмржВ **Roundcube (ржУржпрж╝рзЗржмржорзЗржЗрж▓)** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред ржЖржкржирж┐ рж╢рж┐ржЦржмрзЗржи ржХрж┐ржнрж╛ржмрзЗ ржЗржорзЗрж▓ ржбрзЗрж▓рж┐ржнрж╛рж░рж┐ ржПржмржВ рж░рзЗржкрзБржЯрзЗрж╢ржи ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рждрзЗ **SPF, DKIM, ржПржмржВ DMARC** ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рждрзЗ рж╣ржпрж╝ ржПржмржВ ржПржХржЯрж┐ **ржХрзЗржирзНржжрзНрж░рзАржпрж╝ ржУржпрж╝рзЗржм ржЗржирзНржЯрж╛рж░ржлрзЗрж╕** рж╕рзЗржЯ ржЖржк ржХрж░рзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░ржмрзЗржиред

---

## ЁЯУЛ ржкрзВрж░рзНржмрж╢рж░рзНржд (Prerequisites)

рж╢рзБрж░рзБ ржХрж░рж╛рж░ ржЖржЧрзЗ, ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи ржпрзЗ ржЖржкржирж╛рж░ ржХрж╛ржЫрзЗ ржирж┐ржорзНржирж▓рж┐ржЦрж┐рждржЧрзБрж▓рж┐ рж░ржпрж╝рзЗржЫрзЗ:

1.  **ржЙржмрзБржирзНржЯрзБ 20.04 ржмрж╛ 22.04 LTS** рж╕рж╛рж░рзНржнрж╛рж░ (ржлрзНрж░рзЗрж╢ ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи ржкржЫржирзНржжржирзАржпрж╝)ред
2.  `sudo` ржЕржзрж┐ржХрж╛рж░ рж╕рж╣ ржПржХржЯрж┐ **рж░рзБржЯ ржиржпрж╝ ржПржоржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА**ред
3.  ржПржХржЯрж┐ **ржирж┐ржмржирзНржзрж┐ржд ржбрзЛржорзЗржЗржи ржирж╛ржо** (ржпрзЗржоржи, `paulco.xyz`)ред
4.  ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржирзЗрж░ **DNS ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕** ржпрж╛рждрзЗ ржЖржкржирж┐ `A`, `MX`, `TXT` рж░рзЗржХрж░рзНржб рждрзИрж░рж┐ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред
5.  ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ **рж╕рзНржЯрзНржпрж╛ржЯрж┐ржХ ржкрж╛ржмрж▓рж┐ржХ IP ржарж┐ржХрж╛ржирж╛**ред
6.  ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржлрж╛ржпрж╝рж╛рж░ржУржпрж╝рж╛рж▓рзЗ ржкрзЛрж░рзНржЯ **25 (SMTP)**, **587 (Submission)**, **465 (SMTPS)**, **143 (IMAP)**, **993 (IMAPS)**, **110 (POP3)**, **995 (POP3S)**, ржПржмржВ **80/443 (HTTP/HTTPS)** ржЦрзЛрж▓рж╛ ржерж╛ржХрждрзЗ рж╣ржмрзЗред

---

## ЁЯЪА ржзрж╛ржк рзз: ржкрзНрж░рж╛ржержорж┐ржХ рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзЗржЯржЖржк

### рзз.рзз. рж╣рзЛрж╕рзНржЯржирзЗржо рж╕рзЗржЯ ржХрж░рзБржи

рж╣рзЛрж╕рзНржЯржирзЗржо ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржирзЗрж░ ржПржХржЯрж┐ рж╕рж╛ржмржбрзЛржорзЗржЗржи рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд, ржпрзЗржоржи `mail.yourdomain.com`ред

```bash
sudo hostnamectl set-hostname mail.paulco.xyz
```

### рзз.рзи. `/etc/hosts` ржлрж╛ржЗрж▓ ржЖржкржбрзЗржЯ ржХрж░рзБржи

рж╕рж┐рж╕рзНржЯрзЗржо ржпрзЗржи ржирж┐ржЬрзЗрж░ рж╣рзЛрж╕рзНржЯржирзЗржо рж░рзЗржЬрж▓ржн ржХрж░рждрзЗ ржкрж╛рж░рзЗ рждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржиред

```bash
sudo nano /etc/hosts
```

ржирж┐ржЪрзЗрж░ рж▓рж╛ржЗржиржЯрж┐ ржпрзЛржЧ ржХрж░рзБржи, `192.168.3.55` ржХрзЗ ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ **ржкрзНрж░рж╛ржЗржнрзЗржЯ** IP ржарж┐ржХрж╛ржирж╛ ржПржмржВ `mail.paulco.xyz` ржХрзЗ ржЖржкржирж╛рж░ FQDN ржжрж┐ржпрж╝рзЗ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи ржХрж░рзБржи:

```plaintext
192.168.3.55 mail.paulco.xyz mail
```

### рзз.рзй. рж╣рзЛрж╕рзНржЯржирзЗржо ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи

```bash
hostname -f
# ржЖржЙржЯржкрзБржЯ рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд: mail.paulco.xyz
```

---

## ЁЯз▒ ржзрж╛ржк рзи: LAMP рж╕рзНржЯрзНржпрж╛ржХ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи (Linux, Apache, MariaDB, PHP)

Roundcube, ржУржпрж╝рзЗржмржорзЗржЗрж▓ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ, ржПржХржЯрж┐ ржУржпрж╝рзЗржм рж╕рж╛рж░рзНржнрж╛рж░, ржбрж╛ржЯрж╛ржмрзЗрж╕ ржПржмржВ PHP ржкрзНрж░ржпрж╝рзЛржЬржиред

### рзи.рзз. рж╕рж┐рж╕рзНржЯрзЗржо ржЖржкржбрзЗржЯ ржПржмржВ ржорзВрж▓ ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

```bash
sudo apt-get update -y
sudo apt-get upgrade -y
sudo apt install apache2 mariadb-server mariadb-client -y
```

### рзи.рзи. PHP ржПржмржВ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржПржХрзНрж╕ржЯрзЗржирж╢ржи ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

ржЙржмрзБржирзНржЯрзБ 22.04-ржП ржбрж┐ржлрж▓рзНржЯ PHP рж╣рж▓ 8.1ред ржЙржмрзБржирзНржЯрзБ 20.04-ржП ржЖржкржирж┐ PHP 7.4 ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

```bash
# Ond┼Щej Sur├╜ PPA ржпрзЛржЧ ржХрж░рзБржи (ржЙржмрзБржирзНржЯрзБ 20.04-ржПрж░ ржЬржирзНржп ржРржЪрзНржЫрж┐ржХ)
sudo apt-get update
sudo apt -y install software-properties-common
sudo add-apt-repository ppa:ondrej/php -y
sudo apt-get update

# PHP ржПржмржВ ржПржХрзНрж╕ржЯрзЗржирж╢ржи ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи
sudo apt install php libapache2-mod-php php-mysql php-gd php-xml php-mbstring php-intl php-zip php-json php-curl php-bz2 php-gmp php-imap php-pear php-auth-sasl php-net-idna2 php-mail-mime php-net-ldap3 php-net-sieve -y
```

### рзи.рзй. Apache ржоржбрж┐ржЙрж▓ рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рзБржи

```bash
sudo a2enmod rewrite
sudo systemctl restart apache2
```

---

## ЁЯУо ржзрж╛ржк рзй: Postfix (SMTP рж╕рж╛рж░рзНржнрж╛рж░) ржЗржирж╕рзНржЯрж▓ ржПржмржВ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

Postfix рж╣рж▓ ржорзЗржЗрж▓ ржЯрзНрж░рж╛ржирзНрж╕ржлрж╛рж░ ржПржЬрзЗржирзНржЯ (MTA) ржпрж╛ ржЗржорзЗрж▓ ржкрж╛ржарж╛ржирзЛ ржПржмржВ ржЧрзНрж░рж╣ржгрзЗрж░ ржЬржирзНржп ржжрж╛ржпрж╝рзАред

### рзй.рзз. Postfix ржПржмржВ ржорзЗржЗрж▓ ржЗржЙржЯрж┐рж▓рж┐ржЯрж┐ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

```bash
sudo apt-get install postfix mailutils -y
```

ржЗржирж╕рзНржЯрж▓рзЗрж╢ржирзЗрж░ рж╕ржоржпрж╝, ржПржХржЯрж┐ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржЙржЗржирзНржбрзЛ ржЖрж╕ржмрзЗ:
*   **ржорзЗржЗрж▓ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржирзЗрж░ ржзрж░ржи**: `Internet Site` рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзБржиред
*   **рж╕рж┐рж╕рзНржЯрзЗржо ржорзЗржЗрж▓ ржирж╛ржо**: ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржи рж▓рж┐ржЦрзБржи (ржпрзЗржоржи, `paulco.xyz`)ред ржПржЯрж┐ ржЕрждрзНржпржирзНржд ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржгред

### рзй.рзи. ржорзВрж▓ Postfix ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи

ржЖрж╕рж▓ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ржЯрж┐ ржмрзНржпрж╛ржХржЖржк ржирж┐ржиред

```bash
sudo cp /etc/postfix/main.cf /etc/postfix/main.cf.backup
```

ржорзВрж▓ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ рж╕ржорзНржкрж╛ржжржирж╛ ржХрж░рзБржиред

```bash
sudo nano /etc/postfix/main.cf
```

ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи ржпрзЗ ржирж┐ржорзНржирж▓рж┐ржЦрж┐ржд рж╕рзЗржЯрж┐ржВржЧрзБрж▓рж┐ ржЙржкрж╕рзНржерж┐ржд ржмрж╛ ржЖржкржбрзЗржЯ ржХрж░рж╛ ржЖржЫрзЗред `mail.paulco.xyz` ржПржмржВ `paulco.xyz` ржХрзЗ ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржи ржжрж┐ржпрж╝рзЗ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи ржХрж░рзБржиред

```plaintext
# ржмрзЗрж╕рж┐ржХ рж╕рзЗржЯрж┐ржВ
myhostname = mail.paulco.xyz
mydomain = paulco.xyz
myorigin = $mydomain
inet_interfaces = all
inet_protocols = ipv4 # IPv6 ржерж╛ржХрж▓рзЗ 'all' ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи
mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain
mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128
home_mailbox = Maildir/ # Postfix ржХрзЗ Maildir ржлрж░ржорзНржпрж╛ржЯ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржмрж▓рзЗ

# рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ ржПржмржВ TLS (SSL ржкрж░рзЗ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░ржм)
smtpd_use_tls = yes
smtpd_tls_security_level = may
smtpd_tls_cert_file = /etc/ssl/certs/ssl-cert-snakeoil.pem
smtpd_tls_key_file = /etc/ssl/private/ssl-cert-snakeoil.key

# SMTP рж╕рж╛ржмржорж┐рж╢ржи (ржкрзЛрж░рзНржЯ 587) рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рзБржи
smtpd_sasl_auth_enable = yes
smtpd_sasl_type = dovecot
smtpd_sasl_path = private/auth
smtpd_sasl_security_options = noanonymous
smtpd_sasl_local_domain = $myhostname
smtpd_relay_restrictions = permit_mynetworks, permit_sasl_authenticated, defer_unauth_destination
```

### рзй.рзй. `master.cf` ржлрж╛ржЗрж▓рзЗ SMTP рж╕рж╛ржмржорж┐рж╢ржи рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рзБржи

`master.cf` ржлрж╛ржЗрж▓ рж╕ржорзНржкрж╛ржжржирж╛ ржХрж░рзЗ ржЗржорзЗрж▓ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯрзЗрж░ ржЬржирзНржп ржкрзЛрж░рзНржЯ 587 рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рзБржиред

```bash
sudo nano /etc/postfix/master.cf
```

`submission` рж╕рзЗржХрж╢ржиржЯрж┐ ржЦрзБржБржЬрзБржи ржПржмржВ ржПржЯрж┐ ржЖржиржХржорзЗржирзНржЯ ржХрж░рзБржиред ржПржЯрж┐ ржирж┐ржЪрзЗрж░ ржорждрзЛ ржжрзЗржЦрждрзЗ рж╣ржмрзЗ:

```plaintext
submission inet n       -       y       -       -       smtpd
  -o syslog_name=postfix/submission
  -o smtpd_tls_security_level=encrypt
  -o smtpd_sasl_auth_enable=yes
  -o smtpd_client_restrictions=permit_sasl_authenticated,reject
```

### рзй.рзк. Postfix рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзБржи

```bash
sudo systemctl restart postfix
sudo systemctl status postfix # ржЪрзЗржХ ржХрж░рзБржи рж╕рж╛рж░рзНржнрж╛рж░ ржЪрж╛рж▓рзБ ржЖржЫрзЗ ржХрж┐ржирж╛
```

---

## ЁЯУм ржзрж╛ржк рзк: Dovecot (IMAP/POP3 рж╕рж╛рж░рзНржнрж╛рж░) ржЗржирж╕рзНржЯрж▓ ржПржмржВ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

Dovecot ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ ржорзЗржЗрж▓ржмржХрзНрж╕рзЗ ржЗржорзЗрж▓ ржбрзЗрж▓рж┐ржнрж╛рж░ ржХрж░рзЗ ржПржмржВ IMAP ржмрж╛ POP3 ржПрж░ ржорж╛ржзрзНржпржорзЗ ржЗржорзЗрж▓ ржкрзБржирж░рзБржжрзНржзрж╛рж░ ржХрж░рждрзЗ ржжрзЗржпрж╝ред

### рзк.рзз. Dovecot ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

```bash
sudo apt install dovecot-core dovecot-imapd dovecot-pop3d dovecot-lmtpd -y
```

### рзк.рзи. Dovecot ржорзЗржЗрж▓ рж▓рзЛржХрзЗрж╢ржи ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

ржорзЗржЗрж▓ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ рж╕ржорзНржкрж╛ржжржирж╛ ржХрж░рзБржиред

```bash
sudo nano /etc/dovecot/conf.d/10-mail.conf
```

Postfix-ржПрж░ `home_mailbox` рж╕рзЗржЯрж┐ржВржпрж╝рзЗрж░ рж╕рж╛ржерзЗ ржорж┐рж▓ рж░рзЗржЦрзЗ ржорзЗржЗрж▓ рж▓рзЛржХрзЗрж╢ржи рж╕рзЗржЯ ржХрж░рзБржиред

```plaintext
mail_location = maildir:~/Maildir
```

ржЕржирзНржп ржХрзЛржирзЛ `mail_location` рж▓рж╛ржЗржи ржХржорзЗржирзНржЯ ржЖржЙржЯ ржХрж░рзБржиред

### рзк.рзй. Dovecot ржЕржерзЗржирзНржЯрж┐ржХрзЗрж╢ржи ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

ржЕржерзЗржирзНржЯрж┐ржХрзЗрж╢ржи ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ рж╕ржорзНржкрж╛ржжржирж╛ ржХрж░рзБржиред

```bash
sudo nano /etc/dovecot/conf.d/10-auth.conf
```

ржирж┐ржЪрзЗрж░ ржкрж░рж┐ржмрж░рзНрждржиржЧрзБрж▓рж┐ ржХрж░рзБржи:

```plaintext
disable_plaintext_auth = yes # ржПржиржХрзНрж░рж┐ржкрзНржЯрзЗржб рж▓ржЧржЗржи ржмрж╛ржзрзНржпрждрж╛ржорзВрж▓ржХ ржХрж░рзБржи
auth_mechanisms = plain login # PLAIN ржПржмржВ LOGIN ржорзЗржХрж╛ржирж┐ржЬржо ржЕржирзБржорзЛржжржи ржХрж░рзБржи

# рж╕рж┐рж╕рзНржЯрзЗржо ржЗржЙржЬрж╛рж░ ржЕржерзЗржирзНржЯрж┐ржХрзЗрж╢ржи ржХржорзЗржирзНржЯ ржЖржЙржЯ ржХрж░рзБржи
#!include auth-system.conf.ext

# ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржлрж╛ржЗрж▓ ржЕржерзЗржирзНржЯрж┐ржХрзЗрж╢ржи ржЖржиржХржорзЗржирзНржЯ ржХрж░рзБржи (ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓ ржЗржЙржЬрж╛рж░рзЗрж░ ржЬржирзНржп)
!include auth-passwdfile.conf.ext
```

### рзк.рзк. Postfix-ржПрж░ ржЬржирзНржп Dovecot ржорж╛рж╕рзНржЯрж╛рж░ рж╕ржХрзЗржЯ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

ржорж╛рж╕рзНржЯрж╛рж░ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ рж╕ржорзНржкрж╛ржжржирж╛ ржХрж░рзБржиред

```bash
sudo nano /etc/dovecot/conf.d/10-master.conf
```

`service auth` рж╕рзЗржХрж╢ржиржЯрж┐ ржЦрзБржБржЬрзБржи ржПржмржВ Postfix-ржПрж░ ржЬржирзНржп рж╕ржХрзЗржЯ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржиред

```plaintext
service auth {
  # Postfix smtp-auth
  unix_listener /var/spool/postfix/private/auth {
    mode = 0660
    user = postfix
    group = postfix
  }
}
```

### рзк.рзл. (ржРржЪрзНржЫрж┐ржХ) рж╕рж┐ржХрж┐ржЙрж░ IMAP/POP3 рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рзБржи

IMAPS (993) ржПржмржВ POP3S (995) рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рждрзЗ, `10-master.conf` ржлрж╛ржЗрж▓рзЗ рж╕ржВрж╢рзНрж▓рж┐рж╖рзНржЯ рж╕рзЗржХрж╢ржи ржЦрзБржБржЬрзБржи ржПржмржВ `port` ржПржмржВ `ssl` рж▓рж╛ржЗржиржЧрзБрж▓рж┐ ржЖржиржХржорзЗржирзНржЯ ржХрж░рзБржиред

```plaintext
# IMAPS-ржПрж░ ржЬржирзНржп
inet_listener imaps {
  port = 993
  ssl = yes
}

# POP3S-ржПрж░ ржЬржирзНржп
inet_listener pop3s {
  port = 995
  ssl = yes
}
```

### рзк.рзм. Dovecot рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзБржи

```bash
sudo systemctl restart dovecot
sudo systemctl status dovecot # ржЪрзЗржХ ржХрж░рзБржи рж╕рж╛рж░рзНржнрж╛рж░ ржЪрж╛рж▓рзБ ржЖржЫрзЗ ржХрж┐ржирж╛
```

---

## ЁЯМР ржзрж╛ржк рзл: Roundcube ржУржпрж╝рзЗржмржорзЗржЗрж▓ ржЗржирж╕рзНржЯрж▓ ржПржмржВ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

Roundcube ржЖржкржирж╛рж░ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ ржЬржирзНржп ржЗржорзЗрж▓ ржкрж╛ржарж╛ржирзЛ ржПржмржВ ржЧрзНрж░рж╣ржгрзЗрж░ ржЬржирзНржп ржПржХржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА-ржмрж╛ржирзНржзржм ржУржпрж╝рзЗржм ржЗржирзНржЯрж╛рж░ржлрзЗрж╕ ржкрзНрж░ржжрж╛ржи ржХрж░рзЗред

### рзл.рзз. Roundcube ржбрж╛ржЙржирж▓рзЛржб ржПржмржВ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

```bash
cd /tmp
wget https://github.com/roundcube/roundcubemail/releases/download/1.6.7/roundcubemail-1.6.7-complete.tar.gz
tar -xzf roundcubemail-1.6.7-complete.tar.gz
sudo mv roundcubemail-1.6.7 /var/www/html/roundcube
sudo chown -R www-data:www-data /var/www/html/roundcube/
sudo chmod 755 -R /var/www/html/roundcube/
```

### рзл.рзи. Roundcube-ржПрж░ ржЬржирзНржп MariaDB ржбрж╛ржЯрж╛ржмрзЗрж╕ рждрзИрж░рж┐ ржХрж░рзБржи

```bash
sudo mysql -u root
```

```sql
CREATE DATABASE roundcube_db CHARACTER SET utf8 COLLATE utf8_general_ci;
CREATE USER 'roundcube_user'@'localhost' IDENTIFIED BY 'YourStrongPasswordHere';
GRANT ALL PRIVILEGES ON roundcube_db.* TO 'roundcube_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### рзл.рзй. Roundcube-ржПрж░ ржЗржирж┐рж╢рж┐ржпрж╝рж╛рж▓ ржбрж╛ржЯрж╛ржмрзЗрж╕ рж╕рзНржХрж┐ржорж╛ ржЗржорзНржкрзЛрж░рзНржЯ ржХрж░рзБржи

```bash
sudo mysql -u roundcube_user -p roundcube_db < /var/www/html/roundcube/SQL/mysql.initial.sql
```

### рзл.рзк. Apache ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓ рж╣рзЛрж╕рзНржЯ рждрзИрж░рж┐ ржХрж░рзБржи

Roundcube-ржПрж░ ржЬржирзНржп ржПржХржЯрж┐ ржирждрзБржи ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рзБржиред

```bash
sudo nano /etc/apache2/sites-available/roundcube.conf
```

ржирж┐ржЪрзЗрж░ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржпрзЛржЧ ржХрж░рзБржиред `mail.paulco.xyz` ржХрзЗ ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ FQDN ржжрж┐ржпрж╝рзЗ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи ржХрж░рзБржиред

```apache
<VirtualHost *:80>
    ServerName mail.paulco.xyz

    DocumentRoot /var/www/html/roundcube

    ErrorLog ${APACHE_LOG_DIR}/roundcube_error.log
    CustomLog ${APACHE_LOG_DIR}/roundcube_access.log combined

    <Directory /var/www/html/roundcube>
        Options FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
```

### рзл.рзл. рж╕рж╛ржЗржЯ рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рзБржи ржПржмржВ Apache рж░рж┐рж▓рзЛржб ржХрж░рзБржи

```bash
sudo a2ensite roundcube.conf
sudo systemctl reload apache2
```

### рзл.рзм. ржУржпрж╝рзЗржм ржЗржирж╕рзНржЯрж▓рж╛рж░ ржорж╛ржзрзНржпржорзЗ Roundcube рж╕рзЗржЯржЖржк рж╕ржорзНржкржирзНржи ржХрж░рзБржи

1.  ржЖржкржирж╛рж░ ржУржпрж╝рзЗржм ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ `http://mail.paulco.xyz/roundcube/installer` ржнрж┐ржЬрж┐ржЯ ржХрж░рзБржиред
2.  ржзрж╛ржкржЧрзБрж▓рзЛ ржЕржирзБрж╕рж░ржг ржХрж░рзБржи:
    *   **ржПржиржнрж╛ржпрж╝рж░ржиржорзЗржирзНржЯ ржЪрзЗржХ**: ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи ржпрзЗ рж╕ржорж╕рзНржд ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝рждрж╛ ржкрзВрж░ржг рж╣ржпрж╝рзЗржЫрзЗ (рж╕ржмржХрж┐ржЫрзБ рж╕ржмрзБржЬ рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд)ред
    *   **ржХржиржлрж┐ржЧ рждрзИрж░рж┐ ржХрж░рзБржи**: ржЖржкржирж╛рж░ MariaDB ржмрж┐ржмрж░ржг (ржбрж╛ржЯрж╛ржмрзЗрж╕ ржирж╛ржо, ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржирж╛ржо, ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб) рж▓рж┐ржЦрзБржиред
    *   **ржХржиржлрж┐ржЧ ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи**: ржбрж╛ржЯрж╛ржмрзЗрж╕ ржХрж╛ржирзЗржХрж╢ржи ржПржмржВ IMAP/SMTP рж╕рзЗржЯрж┐ржВ ржЯрзЗрж╕рзНржЯ ржХрж░рзБржиред
        *   **IMAP рж╕рзЗржЯрж┐ржВ**:
            *   `IMAP рж╣рзЛрж╕рзНржЯ`: `localhost`
            *   `IMAP ржкрзЛрж░рзНржЯ`: `143`
            *   `IMAP рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐`: `STARTTLS`
        *   **SMTP рж╕рзЗржЯрж┐ржВ**:
            *   `SMTP рж╣рзЛрж╕рзНржЯ`: `localhost`
            *   `SMTP ржкрзЛрж░рзНржЯ`: `587`
            *   `SMTP рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐`: `STARTTLS`
            *   `SMTP ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржирж╛ржо`: `%u` (ржПржЯрж┐ Roundcube ржХрзЗ рж▓ржЧржЗржи ржХрж░рж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржирж╛ржо ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржмрж▓рзЗ)
            *   `SMTP ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб`: `%p` (ржПржЯрж┐ Roundcube ржХрзЗ рж▓ржЧржЗржи ржХрж░рж╛ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржмрж▓рзЗ)
3.  **ржбрж╛ржЯрж╛ржмрзЗрж╕ ржЗржирж┐рж╢рж┐ржпрж╝рж╛рж▓рж╛ржЗржЬ ржХрж░рзБржи**: ржбрж╛ржЯрж╛ржмрзЗрж╕ ржЗржирж┐рж╢рж┐ржпрж╝рж╛рж▓рж╛ржЗржЬ ржХрж░рж╛рж░ ржЬржирзНржп ржмрж╛ржЯржирзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзБржиред
4.  **ржлрж╛ржЗржирж╛рж▓рж╛ржЗржЬрж┐ржВ**: `config.inc.php` ржлрж╛ржЗрж▓ржЯрж┐ ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржи ржПржмржВ ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗ `/var/www/html/roundcube/config/` ржбрж┐рж░рзЗржХрзНржЯрж░рж┐рждрзЗ ржЖржкрж▓рзЛржб ржХрж░рзБржиред ржЕржержмрж╛, ржЕржирзБржорждрж┐ ржерж╛ржХрж▓рзЗ ржЗржирж╕рзНржЯрж▓рж╛рж░ рж╕рж░рж╛рж╕рж░рж┐ ржПржЯрж┐ рж▓рж┐ржЦрждрзЗ ржкрж╛рж░рзЗред
5.  **рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐**: **ржЗржирж╕рзНржЯрж▓рж╛рж░ ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ ржорзБржЫрзЗ ржлрзЗрж▓рзБржи**ред

```bash
sudo rm -rf /var/www/html/roundcube/installer/
```

---

## ЁЯФР ржзрж╛ржк рзм: ржлрж╛ржпрж╝рж╛рж░ржУржпрж╝рж╛рж▓ (UFW) ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

ржорзЗржЗрж▓ ржПржмржВ ржУржпрж╝рзЗржм рж╕рж╛рж░рзНржнрж┐рж╕рзЗрж░ ржЬржирзНржп ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржкрзЛрж░рзНржЯржЧрзБрж▓рж┐ ржЕржирзБржорзЛржжржи ржХрж░рзБржиред

```bash
sudo ufw allow "Apache Full" # 80 ржПржмржВ 443 ржЕржирзБржорзЛржжржи ржХрж░рзЗ
sudo ufw allow "Postfix"     # 25 ржЕржирзБржорзЛржжржи ржХрж░рзЗ
sudo ufw allow "Postfix Submission" # 587 ржЕржирзБржорзЛржжржи ржХрж░рзЗ
sudo ufw allow "Postfix SMTPS"      # 465 ржЕржирзБржорзЛржжржи ржХрж░рзЗ
sudo ufw allow 993/tcp              # IMAPS
sudo ufw allow 995/tcp              # POP3S
sudo ufw enable # ржлрж╛ржпрж╝рж╛рж░ржУржпрж╝рж╛рж▓ рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рзБржи (ржпржжрж┐ ржЗрждрж┐ржоржзрзНржпрзЗ ржирж╛ ржерж╛ржХрзЗ)
sudo ufw status # ржирж┐ржпрж╝ржоржЧрзБрж▓рж┐ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи
```

---

## тЬЙя╕П ржзрж╛ржк рзн: ржЗржорзЗрж▓ ржЕржерзЗржирзНржЯрж┐ржХрзЗрж╢ржи ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи (SPF, DKIM, DMARC)

ржПржЯрж┐ ржЖржкржирж╛рж░ ржЗржорзЗрж▓ржЧрзБрж▓рж┐ржХрзЗ рж╕рзНржкрзНржпрж╛ржо рж╣рж┐рж╕рж╛ржмрзЗ ржЪрж┐рж╣рзНржирж┐ржд рж╣ржУржпрж╝рж╛ ржерзЗржХрзЗ рж░рзЛржз ржХрж░рж╛рж░ ржЬржирзНржп ржЕрждрзНржпржирзНржд ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржгред

### рзн.рзз. SPF рж░рзЗржХрж░рзНржб рж╕рзЗржЯ ржЖржк ржХрж░рзБржи

**SPF** ржмрж┐рж╢рзНржмржХрзЗ ржЬрж╛ржирж╛ржпрж╝ ржпрзЗ ржХрзЛржи рж╕рж╛рж░рзНржнрж╛рж░ржЧрзБрж▓рж┐ ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржирзЗрж░ рж╣ржпрж╝рзЗ ржЗржорзЗрж▓ ржкрж╛ржарж╛ржирзЛрж░ ржЕржирзБржорждрж┐ ржкрзЗржпрж╝рзЗржЫрзЗред

*   ржЖржкржирж╛рж░ DNS ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ ржкрзНржпрж╛ржирзЗрж▓рзЗ ржпрж╛ржиред
*   ржПржХржЯрж┐ ржирждрзБржи **TXT** рж░рзЗржХрж░рзНржб рждрзИрж░рж┐ ржХрж░рзБржиред
*   **ржирж╛ржо/рж╣рзЛрж╕рзНржЯ**: `@` (ржмрж╛ ржЖржкржирж╛рж░ DNS ржкрзНрж░ржжрж╛ржиржХрж╛рж░рзАрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржХрж░рзЗ ржЦрж╛рж▓рж┐ рж░рж╛ржЦрзБржи)ред
*   **ржорж╛ржи**: `v=spf1 mx a ip4:YOUR_SERVER_IP ~all`
    *   `YOUR_SERVER_IP` ржХрзЗ ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржкрж╛ржмрж▓рж┐ржХ IP ржарж┐ржХрж╛ржирж╛ ржжрж┐ржпрж╝рзЗ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи ржХрж░рзБржиред
    *   `~all` ржорж╛ржирзЗ "рж╕ржлржЯ ржлрзЗржЗрж▓" ржЕржирзНржпрж╛ржирзНржп рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржЬржирзНржп (рж╢рзБрж░рзБрж░ ржЬржирзНржп рж╕рзБржкрж╛рж░рж┐рж╢ ржХрж░рж╛ рж╣ржпрж╝)ред

### рзн.рзи. OpenDKIM ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ DKIM рж╕рзЗржЯ ржЖржк ржХрж░рзБржи

**DKIM** ржЖржкржирж╛рж░ ржЗржорзЗрж▓ржЧрзБрж▓рж┐рждрзЗ ржПржХржЯрж┐ ржбрж┐ржЬрж┐ржЯрж╛рж▓ рж╕рзНржмрж╛ржХрзНрж╖рж░ ржпрзЛржЧ ржХрж░рзЗ, ржкрзНрж░ржорж╛ржг ржХрж░рзЗ ржпрзЗ рж╕рзЗржЧрзБрж▓рж┐ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж╛ рж╣ржпрж╝ржирж┐ред

#### рзн.рзи.рзз. OpenDKIM ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

```bash
sudo apt install opendkim opendkim-tools -y
sudo gpasswd -a postfix opendkim # postfix ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ opendkim ржЧрзНрж░рзБржкрзЗ ржпрзЛржЧ ржХрж░рзБржи
```

#### рзн.рзи.рзи. OpenDKIM ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

ржорзВрж▓ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ рж╕ржорзНржкрж╛ржжржирж╛ ржХрж░рзБржиред

```bash
sudo nano /etc/opendkim.conf
```

ржирж┐ржЪрзЗрж░ рж▓рж╛ржЗржиржЧрзБрж▓рж┐ ржпрзЛржЧ ржХрж░рзБржи ржмрж╛ ржЖржиржХржорзЗржирзНржЯ ржХрж░рзБржиред `paulco.xyz` ржХрзЗ ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржи ржжрж┐ржпрж╝рзЗ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи ржХрж░рзБржиред

```plaintext
Syslog yes
LogWhy yes

# Canonicalization relaxed/simple
Mode sv
SubDomains no

# ржнрж╛рж▓рзЛ ржЕржкрж╛рж░рзЗрж╢ржирзЗрж░ ржЬржирзНржп ржпрзЛржЧ ржХрж░рзБржи
AutoRestart yes
AutoRestartRate 10/1M
Background yes
DNSTimeout 5
SignatureAlgorithm rsa-sha256

# OpenDKIM ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА
UserID opendkim

# рж╕рж╛ржЗржирж┐ржВ ржПржмржВ ржХрзА ржЯрзЗржмрж┐рж▓
KeyTable refile:/etc/opendkim/key.table
SigningTable refile:/etc/opendkim/signing.table

# ржпрж╛ржЪрж╛ржЗржХрж░ржгрзЗрж░ ржЬржирзНржп ржЙржкрзЗржХрзНрж╖рж╛ ржХрж░рж╛рж░ рж╣рзЛрж╕рзНржЯ, ржХрж┐ржирзНрждрзБ рж╕рж╛ржЗржи ржХрж░рж╛рж░ ржЬржирзНржп
ExternalIgnoreList /etc/opendkim/trusted.hosts
InternalHosts /etc/opendkim/trusted.hosts
```

#### рзн.рзи.рзй. ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ ржПржмржВ ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рзБржи

```bash
sudo mkdir /etc/opendkim
sudo mkdir /etc/opendkim/keys
sudo chown -R opendkim:opendkim /etc/opendkim
sudo chmod go-rw /etc/opendkim/keys

# рж╕рж╛ржЗржирж┐ржВ ржЯрзЗржмрж┐рж▓ рждрзИрж░рж┐ ржХрж░рзБржи
sudo nano /etc/opendkim/signing.table
```

ржПржЗ рж▓рж╛ржЗржиржЯрж┐ ржпрзЛржЧ ржХрж░рзБржи (`paulco.xyz` ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи ржХрж░рзБржи):

```plaintext
*@paulco.xyz default._domainkey.paulco.xyz
```

```bash
# ржХрзА ржЯрзЗржмрж┐рж▓ рждрзИрж░рж┐ ржХрж░рзБржи
sudo nano /etc/opendkim/key.table
```

ржПржЗ рж▓рж╛ржЗржиржЯрж┐ ржпрзЛржЧ ржХрж░рзБржи (`paulco.xyz` ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи ржХрж░рзБржи):

```plaintext
default._domainkey.paulco.xyz paulco.xyz:default:/etc/opendkim/keys/paulco.xyz/default.private
```

```bash
# ржЯрзНрж░рж╛рж╕рзНржЯрзЗржб рж╣рзЛрж╕рзНржЯ рждрзИрж░рж┐ ржХрж░рзБржи
sudo nano /etc/opendkim/trusted.hosts
```

ржПржЗ рж▓рж╛ржЗржиржЧрзБрж▓рж┐ ржпрзЛржЧ ржХрж░рзБржи:

```plaintext
127.0.0.1
localhost
.paulco.xyz
```

#### рзн.рзи.рзк. DKIM ржХрзА ржЬрзЗржирж╛рж░рзЗржЯ ржХрж░рзБржи

```bash
sudo mkdir /etc/opendkim/keys/paulco.xyz
sudo opendkim-genkey -b 2048 -d paulco.xyz -D /etc/opendkim/keys/paulco.xyz -s default -v
sudo chown opendkim:opendkim /etc/opendkim/keys/paulco.xyz/default.private
sudo chmod 600 /etc/opendkim/keys/paulco.xyz/default.private
```

#### рзн.рзи.рзл. DNS-ржП DKIM ржкрж╛ржмрж▓рж┐ржХ ржХрзА ржкрзНрж░ржХрж╛рж╢ ржХрж░рзБржи

ржкрж╛ржмрж▓рж┐ржХ ржХрзА ржжрзЗржЦрж╛ржиред

```bash
sudo cat /etc/opendkim/keys/paulco.xyz/default.txt
```

ржЖржкржирж┐ ржПржЗ ржЖржЙржЯржкрзБржЯржЯрж┐ ржжрзЗржЦрждрзЗ ржкрж╛ржмрзЗржи:
`default._domainkey IN TXT ( "v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC..." )`

*   ржЖржкржирж╛рж░ DNS ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ ржкрзНржпрж╛ржирзЗрж▓рзЗ ржпрж╛ржиред
*   ржПржХржЯрж┐ ржирждрзБржи **TXT** рж░рзЗржХрж░рзНржб рждрзИрж░рж┐ ржХрж░рзБржиред
*   **ржирж╛ржо/рж╣рзЛрж╕рзНржЯ**: `default._domainkey` (ржПржЯрж┐ ржЖржкржирж╛рж░ **рж╕рж┐рж▓рзЗржХрзНржЯрж░**)ред
*   **ржорж╛ржи**: **ржкрзНрж░ржержо ржмржирзНржзржирзА `(...)` ржПрж░ ржнрж┐рждрж░рзЗрж░ рж╕ржмржХрж┐ржЫрзБ ржХржкрж┐ ржХрж░рзБржи**, рждрж╛рж░ржкрж░ **рж╕ржорж╕рзНржд ржбрж╛ржмрж▓ ржХрзЛржЯрзЗрж╢ржи `"` ржПржмржВ рж╕рзНржкрзЗрж╕ рж╕рж░рж┐ржпрж╝рзЗ ржлрзЗрж▓рзБржи**ред ржПржЯрж┐ ржПржХржЯрж┐ ржжрзАрж░рзНржШ, ржзрж╛рж░рж╛ржмрж╛рж╣рж┐ржХ рж╕рзНржЯрзНрж░рж┐ржВ рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд ржпрж╛ `v=DKIM1;...` ржжрж┐ржпрж╝рзЗ рж╢рзБрж░рзБ рж╣ржпрж╝ред

#### рзн.рзи.рзм. DKIM ржХрзА ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи

```bash
sudo opendkim-testkey -d paulco.xyz -s default -vvv
```

ржЖржЙржЯржкрзБржЯрзЗ `Key OK` ржжрзЗржЦрждрзЗ ржкрж╛ржмрзЗржиред ржпржжрж┐ `Key not secure` ржжрзЗржЦрзЗржи, рждрж╛рж╣рж▓рзЗ ржЪрж┐ржирзНрждрж╛ ржХрж░ржмрзЗржи ржирж╛; ржПрж░ ржорж╛ржирзЗ ржЖржкржирж┐ DNSSEC рж╕рзЗржЯ ржЖржк ржХрж░рзЗржиржирж┐ред

#### рзн.рзи.рзн. OpenDKIM ржХрзЗ Postfix-ржПрж░ рж╕рж╛ржерзЗ рж╕ржВржпрзБржХрзНржд ржХрж░рзБржи

OpenDKIM ржбрж┐ржлрж▓рзНржЯ ржлрж╛ржЗрж▓ рж╕ржорзНржкрж╛ржжржирж╛ ржХрж░рзЗ Postfix-ржПрж░ chroot jail-ржПрж░ ржЬржирзНржп рж╕ржХрзЗржЯ ржкрж╛рже ржарж┐ржХ ржХрж░рзБржиред

```bash
sudo nano /etc/default/opendkim
```

`SOCKET` рж▓рж╛ржЗржиржЯрж┐ ржЦрзБржБржЬрзБржи ржПржмржВ ржПржЯрж┐ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржи:

```plaintext
SOCKET="local:/var/spool/postfix/opendkim/opendkim.sock"
```

ржПржЦржи, рж╕ржХрзЗржЯ ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ рждрзИрж░рж┐ ржХрж░рзБржи ржПржмржВ ржЕржирзБржорждрж┐ рж╕рзЗржЯ ржХрж░рзБржиред

```bash
sudo mkdir /var/spool/postfix/opendkim
sudo chown opendkim:postfix /var/spool/postfix/opendkim
```

OpenDKIM ржХржиржлрж┐ржЧ ржЖржмрж╛рж░ рж╕ржорзНржкрж╛ржжржирж╛ ржХрж░рзБржи ржпрж╛рждрзЗ рж╕ржарж┐ржХ рж╕ржХрзЗржЯ рж╕рзЗржЯ ржХрж░рж╛ ржпрж╛ржпрж╝ред

```bash
sudo nano /etc/opendkim.conf
```

`Socket` рж▓рж╛ржЗржиржЯрж┐ ржЦрзБржБржЬрзБржи (ржПржЯрж┐ ржХржорзЗржирзНржЯ ржЖржЙржЯ ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗ) ржПржмржВ ржПржЯрж┐ рж╕рзЗржЯ ржХрж░рзБржи:

```plaintext
Socket local:/var/spool/postfix/opendkim/opendkim.sock
```

ржЕржмрж╢рзЗрж╖рзЗ, Postfix ржХрзЗ OpenDKIM milter ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржмрж▓рзБржиред `/etc/postfix/main.cf` рж╕ржорзНржкрж╛ржжржирж╛ ржХрж░рзБржи:

```bash
sudo nano /etc/postfix/main.cf
```

ржлрж╛ржЗрж▓рзЗрж░ **рж╢рзЗрж╖рзЗ** ржПржЗ рж▓рж╛ржЗржиржЧрзБрж▓рж┐ ржпрзЛржЧ ржХрж░рзБржи:

```plaintext
# OpenDKIM-ржПрж░ ржЬржирзНржп Milter ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи
milter_default_action = accept
milter_protocol = 6
smtpd_milters = local:opendkim/opendkim.sock
non_smtpd_milters = $smtpd_milters
```

#### рзн.рзи.рзо. рж╕рж╛рж░рзНржнрж┐рж╕ржЧрзБрж▓рж┐ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзБржи

```bash
sudo systemctl restart opendkim
sudo systemctl restart postfix
```

### рзн.рзй. DMARC рж░рзЗржХрж░рзНржб рж╕рзЗржЯ ржЖржк ржХрж░рзБржи

**DMARC** ржЧрзНрж░рж╣ржгржХрж╛рж░рзА рж╕рж╛рж░рзНржнрж╛рж░ржЧрзБрж▓рж┐ржХрзЗ ржмрж▓рзЗ ржпрзЗ ржХрзА ржХрж░рждрзЗ рж╣ржмрзЗ ржпржжрж┐ ржПржХржЯрж┐ ржЗржорзЗрж▓ SPF ржмрж╛ DKIM ржЪрзЗржХ ржмрзНржпрж░рзНрже рж╣ржпрж╝ред

*   ржЖржкржирж╛рж░ DNS ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ ржкрзНржпрж╛ржирзЗрж▓рзЗ ржпрж╛ржиред
*   ржПржХржЯрж┐ ржирждрзБржи **TXT** рж░рзЗржХрж░рзНржб рждрзИрж░рж┐ ржХрж░рзБржиред
*   **ржирж╛ржо/рж╣рзЛрж╕рзНржЯ**: `_dmarc`ред
*   **ржорж╛ржи**: `v=DMARC1; p=none; rua=mailto:postmaster@paulco.xyz; ruf=mailto:postmaster@paulco.xyz; fo=1`
    *   `p=none`: рж╢рзБржзрзБржорж╛рждрзНрж░ ржоржирж┐ржЯрж░ ржХрж░рзБржи, рж░рж┐ржЬрзЗржХрзНржЯ/ржХрзЛржпрж╝рж╛рж░рзЗржирзНржЯрж╛ржЗржи ржХрж░ржмрзЗржи ржирж╛ред рж╕ржмржХрж┐ржЫрзБ ржарж┐ржХржарж╛ржХ ржХрж╛ржЬ ржХрж░ржЫрзЗ ржирж┐рж╢рзНржЪрж┐ржд рж╣ржУржпрж╝рж╛рж░ ржкрж░ `p=quarantine` ржмрж╛ `p=reject` ржП ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржиред
    *   `postmaster@paulco.xyz` ржХрзЗ ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржбржорж┐ржи ржЗржорзЗрж▓ ржжрж┐ржпрж╝рзЗ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи ржХрж░рзБржиред

---

## ЁЯСе ржзрж╛ржк рзо: ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ (ржХрзЗржирзНржжрзНрж░рзАржпрж╝ ржУржпрж╝рзЗржм ржЗржирзНржЯрж╛рж░ржлрзЗрж╕)

ржЙржкрж░рзЗрж░ рж╕рзЗржЯржЖржкржЯрж┐ рж╕рж┐рж╕рзНржЯрзЗржо ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ (ржпрж╛рж░рж╛ `adduser` ржжрж┐ржпрж╝рзЗ рждрзИрж░рж┐ рж╣ржпрж╝)ред ржПржХржЯрж┐ ржХрзЗржирзНржжрзНрж░рзАржпрж╝ ржУржпрж╝рзЗржм ржЗржирзНржЯрж╛рж░ржлрзЗрж╕ ржерзЗржХрзЗ ржЗржорзЗрж▓ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛рж░ ржЬржирзНржп, ржЖржкржирж╛ржХрзЗ **ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА** рж╕рзЗржЯ ржЖржк ржХрж░рждрзЗ рж╣ржмрзЗред ржПржЯрж┐ ржЖрж░ржУ ржЬржЯрж┐рж▓ ржХрж┐ржирзНрждрзБ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржЬржирзНржп рж╕рзНржЯрзНржпрж╛ржирзНржбрж╛рж░рзНржбред

### рзо.рзз. ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржХрзЗржи?

*   **рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐**: ржЗржорзЗрж▓ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗ рж╢рзЗрж▓ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржерж╛ржХржмрзЗ ржирж╛ред
*   **рж╕рзНржХрзЗрж▓рзЗржмрж┐рж▓рж┐ржЯрж┐**: рж╢ржд рж╢ржд ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛ рж╕рж╣ржЬред
*   **ржХрзЗржирзНржжрзНрж░рзАржпрж╝ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ**: ржПржХржЯрж┐ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗрж░ рж╕рж╛ржерзЗ ржЗржирзНржЯрж┐ржЧрзНрж░рзЗржЯ ржХрж░рж╛ ржпрж╛ржпрж╝ ржПржмржВ ржПржХржЯрж┐ ржУржпрж╝рзЗржм ржкрзНржпрж╛ржирзЗрж▓ ржжрж┐ржпрж╝рзЗ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛ ржпрж╛ржпрж╝ред

### рзо.рзи. ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржЬржирзНржп Postfix ржПржмржВ Dovecot ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

ржПржЯрж┐ ржПржХржЯрж┐ ржЙрж▓рзНрж▓рзЗржЦржпрзЛржЧрзНржп ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржкрж░рж┐ржмрж░рзНрждржиред ржПржЦрж╛ржирзЗ ржПржХржЯрж┐ ржЙржЪрзНржЪ-рж╕рзНрждрж░рзЗрж░ ржУржнрж╛рж░ржнрж┐ржЙ ржжрзЗржУржпрж╝рж╛ рж╣рж▓:

1.  **ржбрж╛ржЯрж╛ржмрзЗрж╕ рж╕рзЗржЯржЖржк**: ржПржХржЯрж┐ ржирждрзБржи MariaDB ржбрж╛ржЯрж╛ржмрзЗрж╕ (ржпрзЗржоржи, `mailserver_db`) рждрзИрж░рж┐ ржХрж░рзБржи `virtual_domains`, `virtual_users`, ржПржмржВ `virtual_aliases` ржЯрзЗржмрж┐рж▓ рж╕рж╣ред
2.  **Postfix ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи**:
    *   `/etc/postfix/main.cf` рж╕ржорзНржкрж╛ржжржирж╛ ржХрж░рзБржи ржпрж╛рждрзЗ SQL рж▓рзБржХржЖржк ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржбрзЛржорзЗржЗржи, ржорзЗржЗрж▓ржмржХрзНрж╕ ржПржмржВ ржЕрзНржпрж╛рж▓рж┐ржпрж╝рж╛рж╕рзЗрж░ ржЬржирзНржпред
    *   `virtual_mailbox_domains`, `virtual_mailbox_maps`, `virtual_alias_maps` ржХрзЗ SQL ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓рзЗрж░ ржкржерзЗ рж╕рзЗржЯ ржХрж░рзБржи (ржпрзЗржоржи, `/etc/postfix/mysql-virtual-mailbox-domains.cf`)ред
    *   `virtual_mailbox_base = /var/mail/vhosts` ржПржмржВ `virtual_uid_maps = static:5000`, `virtual_gid_maps = static:5000` рж╕рзЗржЯ ржХрж░рзБржиред
3.  **Dovecot ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи**:
    *   `/etc/dovecot/conf.d/10-mail.conf` рж╕ржорзНржкрж╛ржжржирж╛ ржХрж░рзБржи ржпрж╛рждрзЗ `mail_location = maildir:/var/mail/vhosts/%d/%n` рж╕рзЗржЯ ржХрж░рж╛ ржпрж╛ржпрж╝ред
    *   `/etc/dovecot/conf.d/10-auth.conf` рж╕ржорзНржкрж╛ржжржирж╛ ржХрж░рзБржи ржпрж╛рждрзЗ `!include auth-passwdfile.conf.ext` ржЖржиржХржорзЗржирзНржЯ ржХрж░рж╛ ржерж╛ржХрзЗ ржПржмржВ `!include auth-system.conf.ext` ржХржорзЗржирзНржЯ ржЖржЙржЯ ржХрж░рж╛ ржерж╛ржХрзЗред
    *   `/etc/dovecot/conf.d/auth-sql.conf.ext` рж╕ржорзНржкрж╛ржжржирж╛ ржХрж░рзБржи ржпрж╛рждрзЗ SQL ржЕржерзЗржирзНржЯрж┐ржХрзЗрж╢ржи ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рж╛ ржпрж╛ржпрж╝ред
    *   ржПржХржЯрж┐ `vmail` рж╕рж┐рж╕рзНржЯрзЗржо ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржПржмржВ ржЧрзНрж░рзБржк (UID/GID 5000) рждрзИрж░рж┐ ржХрж░рзБржи ржПржмржВ `/var/mail/vhosts` ржПрж░ ржорж╛рж▓рж┐ржХрж╛ржирж╛ рж╕рзЗржЯ ржХрж░рзБржиред
4.  **SQL ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рзБржи**: `/etc/postfix/mysql-virtual-mailbox-domains.cf` ржПрж░ ржорждрзЛ ржлрж╛ржЗрж▓ржЧрзБрж▓рж┐ рждрзИрж░рж┐ ржХрж░рзБржи ржпрж╛рждрзЗ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржХрж╛ржирзЗржХрж╢ржи ржмрж┐ржмрж░ржг ржПржмржВ ржХрзЛржпрж╝рзЗрж░рж┐ ржерж╛ржХрзЗред

### рзо.рзй. ржПржХржЯрж┐ ржУржпрж╝рзЗржм-ржнрж┐рждрзНрждрж┐ржХ ржХржирзНржЯрзНрж░рзЛрж▓ ржкрзНржпрж╛ржирзЗрж▓ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

ржПржЗ ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ ржПржХржЯрж┐ ржУржпрж╝рзЗржм ржЗржирзНржЯрж╛рж░ржлрзЗрж╕ ржерзЗржХрзЗ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рждрзЗ, ржЖржкржирж┐ **PostfixAdmin** ржПрж░ ржорждрзЛ ржПржХржЯрж┐ ржХржирзНржЯрзНрж░рзЛрж▓ ржкрзНржпрж╛ржирзЗрж▓ ржЗржирж╕рзНржЯрж▓ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

#### рзо.рзй.рзз. PostfixAdmin ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

```bash
cd /tmp
wget https://github.com/postfixadmin/postfixadmin/archive/refs/tags/postfixadmin-3.3.13.tar.gz
tar -xzf postfixadmin-3.3.13.tar.gz
sudo mv postfixadmin-postfixadmin-3.3.13 /var/www/html/postfixadmin
sudo chown -R www-data:www-data /var/www/html/postfixadmin
```

#### рзо.рзй.рзи. PostfixAdmin ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

1.  `http://mail.paulco.xyz/postfixadmin/setup.php` ржнрж┐ржЬрж┐ржЯ ржХрж░рзБржиред
2.  ржПржЯрж┐ ржЖржкржирж╛ржХрзЗ ржПржХржЯрж┐ рж╕рзЗржЯржЖржк ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рждрзИрж░рж┐ ржХрж░рждрзЗ ржПржмржВ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рждрзЗ ржирж┐рж░рзНржжрзЗрж╢ржирж╛ ржжрзЗржмрзЗред
3.  рж╕рзЗржЯржЖржк рж╢рзЗрж╖рзЗ, ржПржЯрж┐ ржЖржкржирж╛ржХрзЗ `config.local.php` ржлрж╛ржЗрж▓рзЗрж░ ржЬржирзНржп ржПржХржЯрж┐ рж╣рзНржпрж╛рж╢ржб ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржкрзНрж░ржжрж╛ржи ржХрж░ржмрзЗред
4.  `/var/www/html/postfixadmin/config.local.php` рждрзИрж░рж┐ ржХрж░рзБржи ржПржмржВ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржПржмржВ ржЕрзНржпрж╛ржбржорж┐ржи ржХрзНрж░рзЗржбрзЗржирж╢рж┐ржпрж╝рж╛рж▓ ржпрзЛржЧ ржХрж░рзБржиред
5.  **рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐**: `setup.php` ржлрж╛ржЗрж▓ржЯрж┐ ржорзБржЫрзЗ ржлрзЗрж▓рзБржи ржмрж╛ рж░рж┐ржирзЗржо ржХрж░рзБржиред

#### рзо.рзй.рзй. Roundcube-ржПрж░ рж╕рж╛ржерзЗ ржЗржирзНржЯрж┐ржЧрзНрж░рзЗржЯ ржХрж░рзБржи (ржРржЪрзНржЫрж┐ржХ)

ржЖржкржирж┐ **Roundcube PostfixAdmin ржкрзНрж▓рж╛ржЧржЗржи** ржЗржирж╕рзНржЯрж▓ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи ржпрж╛рждрзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░рж╛ рж╕рж░рж╛рж╕рж░рж┐ Roundcube ржерзЗржХрзЗ рждрж╛ржжрзЗрж░ ржирж┐ржЬрж╕рзНржм ржЕрзНржпрж╛рж▓рж┐ржпрж╝рж╛рж╕ ржПржмржВ ржнрзНржпрж╛ржХрзЗрж╢ржи ржорзЗрж╕рзЗржЬ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рждрзЗ ржкрж╛рж░рзЗред

---

## ЁЯзк ржзрж╛ржк рзп: ржЖржкржирж╛рж░ ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░ ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи

1.  **ржПржХржЯрж┐ ржЯрзЗрж╕рзНржЯ ржЗржорзЗрж▓ ржкрж╛ржарж╛ржи**: Roundcube-ржП рж▓ржЧржЗржи ржХрж░рзБржи (`http://mail.paulco.xyz/roundcube`) ржПржмржВ ржПржХржЯрж┐ Gmail ржмрж╛ Outlook ржарж┐ржХрж╛ржирж╛ржпрж╝ ржПржХржЯрж┐ ржЗржорзЗрж▓ ржкрж╛ржарж╛ржиред
2.  **ржЗржорзЗрж▓ рж╣рзЗржбрж╛рж░ ржЪрзЗржХ ржХрж░рзБржи**: Gmail-ржП, ржЗржорзЗрж▓ржЯрж┐ ржЦрзБрж▓рзБржи ржПржмржВ "Show original" ржХрзНрж▓рж┐ржХ ржХрж░рзБржиред `spf=pass` ржПржмржВ `dkim=pass` ржЦрзБржБржЬрзБржиред
3.  **ржЕржирж▓рж╛ржЗржи ржЯрзБрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи**:
    *   **Mail Tester**: `https://www.mail-tester.com` ржП ржпрж╛ржи, ржкрзНрж░ржжрждрзНржд ржарж┐ржХрж╛ржирж╛ржпрж╝ ржПржХржЯрж┐ ржЗржорзЗрж▓ ржкрж╛ржарж╛ржи ржПржмржВ ржЖржкржирж╛рж░ рж╕рзНржХрзЛрж░ ржЪрзЗржХ ржХрж░рзБржиред
    *   **DKIM Validator**: `https://www.dmarcanalyzer.com/dkim/dkim-check/` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЖржкржирж╛рж░ DKIM рж░рзЗржХрж░рзНржб ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржиред
    *   **SPF Validator**: `https://www.kitterman.com/spf/validate.html` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЖржкржирж╛рж░ SPF рж░рзЗржХрж░рзНржб ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржиред

---

## ЁЯЫбя╕П ржзрж╛ржк рззрзж: ржЙржирзНржиржд рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ ржПржмржВ рж░ржХрзНрж╖ржгрж╛ржмрзЗржХрзНрж╖ржг

*   **Fail2ban ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи**: Postfix, Dovecot ржПржмржВ SSH-ржП ржмрзНрж░рзБржЯ-ржлрзЛрж░рзНрж╕ ржЕрзНржпрж╛ржЯрж╛ржХ ржерзЗржХрзЗ рж░ржХрзНрж╖рж╛ ржХрж░рзЗред
    ```bash
    sudo apt install fail2ban -y
    ```
*   **ржЕржЯрзЛржорзЗржЯрж┐ржХ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ ржЖржкржбрзЗржЯ рж╕рзЗржЯ ржЖржк ржХрж░рзБржи**:
    ```bash
    sudo apt install unattended-upgrades -y
    sudo dpkg-reconfigure unattended-upgrades # 'Yes' рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзБржи
    ```
*   **рж▓ржЧ ржоржирж┐ржЯрж░ ржХрж░рзБржи**: ржирж┐ржпрж╝ржорж┐ржд `/var/log/mail.log`, `/var/log/mail.err`, ржПржмржВ `/var/log/syslog` ржЪрзЗржХ ржХрж░рзБржиред
*   **ржмрзНржпрж╛ржХржЖржк**: ржирж┐ржпрж╝ржорж┐ржд ржЖржкржирж╛рж░ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ (`/etc/postfix`, `/etc/dovecot`, `/etc/opendkim`) ржПржмржВ MariaDB ржбрж╛ржЯрж╛ржмрзЗрж╕ржЧрзБрж▓рж┐ ржмрзНржпрж╛ржХржЖржк ржХрж░рзБржиред

---

## ЁЯУЭ ржЖржкржирж╛рж░ ржорзВрж▓ ржХржиржЯрзЗржирзНржЯрзЗрж░ рж╕ржВрж╢рзЛржзржи ржПржмржВ ржЙржирзНржиржпрж╝ржи

*   **PHP ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи**: ржЙржмрзБржирзНржЯрзБ 20.04-ржП ржнрж╛рж▓рзЛ PHP ржнрж╛рж░рзНрж╕ржи ржХржирзНржЯрзНрж░рзЛрж▓рзЗрж░ ржЬржирзНржп `ondrej/php` PPA ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред
*   **Postfix ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи**: ржЖрж░ржУ рж╕ржорзНржкрзВрж░рзНржг ржПржмржВ рж╕рж┐ржХрж┐ржЙрж░ `main.cf` ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржкрзНрж░ржжрж╛ржи ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ, SASL ржЕржерзЗржирзНржЯрж┐ржХрзЗрж╢ржи рж╕рж╣ред
*   **Dovecot ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи**: Postfix-ржПрж░ рж╕рж╛ржерзЗ `private/auth` рж╕ржХрзЗржЯ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж╕ржарж┐ржХржнрж╛ржмрзЗ ржЗржирзНржЯрж┐ржЧрзНрж░рзЗржЯ ржХрж░рж╛рж░ ржЬржирзНржп ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи рж╕ржВрж╢рзЛржзржи ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ ржПржмржВ `Maildir` рж╕рзЗржЯ ржЖржк ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред
*   **Roundcube ржнрж╛рж░рзНрж╕ржи**: ржПржХржЯрж┐ ржЖрж░ржУ рж╕рж╛ржорзНржкрзНрж░рждрж┐ржХ, рж╕рзНржерж┐рждрж┐рж╢рзАрж▓ ржнрж╛рж░рзНрж╕ржи (1.6.7) ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред
*   **ржлрж╛ржпрж╝рж╛рж░ржУржпрж╝рж╛рж▓**: IMAPS (993) ржПржмржВ POP3S (995) ржПрж░ ржЬржирзНржп ржирж┐ржпрж╝ржо ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред
*   **SPF/DKIM/DMARC**: ржЗржорзЗрж▓ ржбрзЗрж▓рж┐ржнрж╛рж░рж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рж╛рж░ ржЬржирзНржп рж╕ржорж╕рзНржд рждрж┐ржиржЯрж┐рж░ ржЬржирзНржп ржПржХржЯрж┐ рж╕ржорзНржкрзВрж░рзНржг, ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ ржЧрж╛ржЗржб ржкрзНрж░ржжрж╛ржи ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред ржЖржкржирж╛рж░ ржорзВрж▓ ржЧрж╛ржЗржбрзЗ рж╢рзБржзрзБржорж╛рждрзНрж░ SPF ржЖржВрж╢рж┐ржХржнрж╛ржмрзЗ ржХржнрж╛рж░ ржХрж░рж╛ ржЫрж┐рж▓ред
*   **ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ**: **ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА** ржПржмржВ ржПржХржЯрж┐ **ржУржпрж╝рзЗржм-ржнрж┐рждрзНрждрж┐ржХ ржХржирзНржЯрзНрж░рзЛрж▓ ржкрзНржпрж╛ржирзЗрж▓ (PostfixAdmin)** рж╕рзЗржЯ ржЖржк ржХрж░рж╛рж░ ржЬржирзНржп ржПржХржЯрж┐ ржирж┐ржмрзЗржжрж┐ржд ржмрж┐ржнрж╛ржЧ ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ, ржпрж╛ ржПржХржЯрж┐ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржЕржирзБржкрж╕рзНржерж┐ржд ржЕржВрж╢ ржЫрж┐рж▓ред
*   **ржЯрзЗрж╕рзНржЯрж┐ржВ**: ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░ рж╕ржорзНржкрзВрж░рзНржгрж░рзВржкрзЗ ржЯрзЗрж╕рзНржЯ ржХрж░рж╛рж░ ржЬржирзНржп ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржзрж╛ржк ржПржмржВ ржЯрзБрж▓ ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред
*   **рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░**: ржПржХржЯрж┐ ржорж╕рзГржг рж╕рзЗржЯржЖржк ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛рж░ ржЬржирзНржп ржпрзМржХрзНрждрж┐ржХ, ржХрж╛рж▓рж╛ржирзБржХрзНрж░ржорж┐ржХ ржХрзНрж░ржорзЗ ржзрж╛ржкржЧрзБрж▓рж┐ ржкрзБржирж░рзНржЧржаржи ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред
*   **рж╕рзНржкрж╖рзНржЯрждрж╛**: ржЧрзЛржЯрж╛ ржЧрж╛ржЗржб ржЬрзБржбрж╝рзЗ ржЖрж░ржУ ржмрзНржпрж╛ржЦрзНржпрж╛ржорзВрж▓ржХ ржоржирзНрждржмрзНржп ржПржмржВ ржкрзНрж░рзЗржХрзНрж╖рж╛ржкржЯ ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред

ржПржЗ ржЧрж╛ржЗржбржЯрж┐ ржПржХржЯрж┐ рж╕рзНржм-рж╣рзЛрж╕рзНржЯрзЗржб ржЗржорзЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзЗржЯ ржЖржк ржХрж░рж╛рж░ ржЬржирзНржп ржПржХржЯрж┐ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА ржнрж┐рждрзНрждрж┐ ржкрзНрж░ржжрж╛ржи ржХрж░рзЗред ржоржирзЗ рж░рж╛ржЦржмрзЗржи ржпрзЗ ржПржХржЯрж┐ ржорзЗржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░ ржмржЬрж╛ржпрж╝ рж░рж╛ржЦрж╛ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐, рж░рзЗржкрзБржЯрзЗрж╢ржи ржПржмржВ ржбрзЗрж▓рж┐ржнрж╛рж░рж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рж╛рж░ ржЬржирзНржп ржЪрж▓ржорж╛ржи ржкрзНрж░ржЪрзЗрж╖рзНржЯрж╛ ржкрзНрж░ржпрж╝рзЛржЬржиред
